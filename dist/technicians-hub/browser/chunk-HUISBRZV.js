import{a as D}from"./chunk-DWI4HAM7.js";import{a as J,b as H}from"./chunk-3NY7DZAO.js";import{a as ve,b as Se}from"./chunk-IG52HGJK.js";import{c as X,d as Y}from"./chunk-F3IDZWT3.js";import{a as C,b}from"./chunk-Y3GYSLY6.js";import{c as fe,d as ge,e as ze}from"./chunk-7YQTHMTJ.js";import{c as ae,d as oe,e as se,f as ce,g as le,h as me,i as ue}from"./chunk-H2G74B6L.js";import"./chunk-CESBHL5B.js";import"./chunk-GC2JCOQQ.js";import{a as de,b as pe}from"./chunk-2QDM327Y.js";import{a as K,b as W,c as G}from"./chunk-H5EFK6NK.js";import{g as Z,h as ee,j as te,k as ne}from"./chunk-Y4SKA4DN.js";import{a as re,c as ie}from"./chunk-LF3AIU6I.js";import"./chunk-OX3V4ML4.js";import"./chunk-5AAZBCL7.js";import{e as U}from"./chunk-6RCJUTWS.js";import"./chunk-YLQVLZ7P.js";import"./chunk-CN3ZPC5G.js";import"./chunk-4VDSMCYZ.js";import{Ha as Q,Ia as $,j as B,k as V,p as M}from"./chunk-7ENSWGND.js";import{Lc as F,Mc as x,Sb as l,Sc as k,Tb as r,Ub as i,Vb as d,a as z,aa as T,ac as j,b as y,bb as s,ea as f,fc as w,hc as S,i as R,la as N,lb as g,ma as P,rb as O,rc as I,wc as c,xb as v,xc as p,yc as _,zc as A}from"./chunk-WBOJ7OJP.js";var E=class a{constructor(t){this.inventoryService=t}reservationsSubject=new R([]);reservations$=this.reservationsSubject.asObservable();generateId(){return"RES-"+Math.random().toString(36).substr(2,6).toUpperCase()}getAll(){return this.reservationsSubject.value}getById(t){return this.reservationsSubject.value.find(e=>e.id===t)}getByWorkOrder(t){return this.reservationsSubject.value.filter(e=>e.workOrderId===t)}getByStatus(t){return this.reservationsSubject.value.filter(e=>e.status===t)}getBackorderedReservations(){return this.getByStatus("BACKORDERED")}reserve(t,e,n,o){if(!this.inventoryService.reserveStock(n,e,o))return null;let u={id:this.generateId(),workOrderId:t,itemId:e,locationId:n,qty:o,status:"RESERVED",createdAt:new Date().toISOString()};return this.reservationsSubject.next([...this.reservationsSubject.value,u]),u}createBackorder(t,e,n,o){let m={id:this.generateId(),workOrderId:t,itemId:e,locationId:n,qty:o,status:"BACKORDERED",createdAt:new Date().toISOString()};return this.reservationsSubject.next([...this.reservationsSubject.value,m]),m}release(t){let e=this.reservationsSubject.value,n=e.findIndex(m=>m.id===t);if(n===-1)return!1;let o=e[n];return o.status!=="RESERVED"?!1:(this.inventoryService.releaseReserved(o.locationId,o.itemId,o.qty),e[n]=y(z({},o),{status:"RELEASED"}),this.reservationsSubject.next([...e]),!0)}consume(t,e){let n=this.reservationsSubject.value,o=n.findIndex(u=>u.id===t);if(o===-1)return!1;let m=n[o];return m.status!=="RESERVED"?!1:(this.inventoryService.postTransaction({type:"ISSUE_TO_ORDER",itemId:m.itemId,qty:m.qty,fromLocationId:m.locationId,workOrderId:e,reason:"Consumed on work order completion"}),n[o]=y(z({},m),{status:"CONSUMED"}),this.reservationsSubject.next([...n]),!0)}updateStatus(t,e){let n=this.reservationsSubject.value,o=n.findIndex(m=>m.id===t);if(o!==-1)return n[o]=y(z({},n[o]),{status:e}),this.reservationsSubject.next([...n]),n[o]}static \u0275fac=function(e){return new(e||a)(f(b))};static \u0275prov=T({token:a,factory:a.\u0275fac,providedIn:"root"})};var q=class a{constructor(t,e,n,o){this.inventoryService=t;this.locationService=e;this.reservationService=n;this.transferService=o}requestsSubject=new R([]);requests$=this.requestsSubject.asObservable();generateId(){return"REQ-"+Math.random().toString(36).substr(2,6).toUpperCase()}getAll(){return this.requestsSubject.value}getById(t){return this.requestsSubject.value.find(e=>e.id===t)}getByWorkOrder(t){return this.requestsSubject.value.filter(e=>e.workOrderId===t)}getByStatus(t){return this.requestsSubject.value.filter(e=>e.status===t)}getOpenRequests(){return this.requestsSubject.value.filter(t=>!["FULFILLED","REJECTED"].includes(t.status))}create(t,e,n,o,m){let u=new Date().toISOString(),h={id:this.generateId(),workOrderId:t,technicianId:e,itemId:n,qty:o,status:"REQUESTED",reason:m,createdAt:u,updatedAt:u};return this.requestsSubject.next([...this.requestsSubject.value,h]),h}updateStatus(t,e){let n=this.requestsSubject.value,o=n.findIndex(m=>m.id===t);if(o!==-1)return n[o]=y(z({},n[o]),{status:e,updatedAt:new Date().toISOString()}),this.requestsSubject.next([...n]),n[o]}approve(t){let e=this.getById(t);if(!(!e||e.status!=="REQUESTED"))return this.updateStatus(t,"APPROVED")}reject(t){return this.updateStatus(t,"REJECTED")}allocateFromLocation(t,e){let n=this.getById(t);if(!n)return{success:!1,needsTransfer:!1};let o=this.inventoryService.getBalance(e,n.itemId);if(!o||o.available<n.qty)return{success:!1,needsTransfer:!1};let m=this.reservationService.reserve(n.workOrderId,n.itemId,e,n.qty);if(!m)return{success:!1,needsTransfer:!1};let u=this.locationService.getTruckForTechnician(n.technicianId),h=u?e!==u.id:!1;return this.updateStatus(t,"ALLOCATED"),{success:!0,reservation:m,needsTransfer:h,truckLocationId:u?.id}}createTransferForRequest(t,e,n){let o=this.getById(t);if(!o)return{success:!1};let m=this.transferService.create(e,n,[{itemId:o.itemId,qty:o.qty}],o.workOrderId);return this.updateStatus(t,"TRANSFER_CREATED"),{success:!0,transfer:m}}fulfill(t){return this.updateStatus(t,"FULFILLED")}backorder(t){let e=this.getById(t);if(!e)return;let n=this.locationService.getTruckForTechnician(e.technicianId);return n&&this.reservationService.createBackorder(e.workOrderId,e.itemId,n.id,e.qty),this.updateStatus(t,"BACKORDERED")}static \u0275fac=function(e){return new(e||a)(f(b),f(C),f(E),f(D))};static \u0275prov=T({token:a,factory:a.\u0275fac,providedIn:"root"})};var L=a=>({color:a}),_e=()=>({color:"#1890ff"});function xe(a,t){a&1&&(r(0,"button",27),c(1,"View All Items"),i())}function Ce(a,t){if(a&1&&(r(0,"tr")(1,"td"),c(2),r(3,"small"),c(4),i()(),r(5,"td")(6,"nz-tag",30),c(7),i()(),r(8,"td"),d(9,"nz-badge",31),i(),r(10,"td"),c(11),i(),r(12,"td"),c(13),i()()),a&2){let e=t.$implicit;s(2),_("",e.item.name," "),s(2),_("(",e.item.sku,")"),s(2),l("nzColor",e.location.type==="WAREHOUSE"?"blue":"green"),s(),p(e.location.name),s(2),l("nzText",e.balance.available.toString()),s(2),p(e.item.reorderPoint||"-"),s(2),p(e.item.reorderQty||"-")}}function De(a,t){if(a&1&&(r(0,"nz-table",28,2)(2,"thead")(3,"tr")(4,"th"),c(5,"Item"),i(),r(6,"th"),c(7,"Location"),i(),r(8,"th"),c(9,"Available"),i(),r(10,"th"),c(11,"Reorder Point"),i(),r(12,"th"),c(13,"Suggested"),i()()(),r(14,"tbody"),v(15,Ce,14,7,"tr",29),i()()),a&2){let e=I(1),n=S();l("nzData",n.lowStockItems)("nzPageSize",5),s(15),l("ngForOf",e.data)}}function qe(a,t){a&1&&d(0,"nz-empty",32)}function ke(a,t){a&1&&(r(0,"button",33),c(1,"View All"),i())}function Le(a,t){if(a&1&&(r(0,"tr")(1,"td")(2,"a",34),c(3),i()(),r(4,"td"),c(5),i(),r(6,"td")(7,"nz-tag",30),c(8),i()(),r(9,"td"),c(10),i()()),a&2){let e=t.$implicit,n=S(2);s(3),p(e.id),s(2),A("",n.getLocationName(e.fromLocationId)," \u2192 ",n.getLocationName(e.toLocationId)),s(2),l("nzColor",n.getTransferStatusColor(e.status)),s(),p(n.getTransferStatusLabel(e.status)),s(2),_("",e.lines.length," item(s)")}}function Ne(a,t){if(a&1&&(r(0,"nz-table",28,3)(2,"thead")(3,"tr")(4,"th"),c(5,"ID"),i(),r(6,"th"),c(7,"From \u2192 To"),i(),r(8,"th"),c(9,"Status"),i(),r(10,"th"),c(11,"Lines"),i()()(),r(12,"tbody"),v(13,Le,11,6,"tr",29),i()()),a&2){let e=I(1),n=S();l("nzData",n.openTransfers)("nzPageSize",5),s(13),l("ngForOf",e.data)}}function Pe(a,t){a&1&&d(0,"nz-empty",35)}function Oe(a,t){if(a&1){let e=j();r(0,"button",37),w("click",function(){N(e);let o=S().$implicit,m=S(2);return P(m.approveRequest(o))}),c(1,"Approve"),i()}}function je(a,t){if(a&1&&(r(0,"tr")(1,"td"),c(2),i(),r(3,"td"),c(4),i(),r(5,"td"),c(6),i(),r(7,"td")(8,"nz-tag",30),c(9),i()(),r(10,"td"),v(11,Oe,2,0,"button",36),i()()),a&2){let e=t.$implicit,n=S(2);s(2),p(e.workOrderId),s(2),p(n.getItemName(e.itemId)),s(2),p(e.qty),s(2),l("nzColor",n.getRequestStatusColor(e.status)),s(),p(n.getRequestStatusLabel(e.status)),s(2),l("ngIf",e.status==="REQUESTED")}}function we(a,t){if(a&1&&(r(0,"nz-table",28,4)(2,"thead")(3,"tr")(4,"th"),c(5,"Work Order"),i(),r(6,"th"),c(7,"Item"),i(),r(8,"th"),c(9,"Qty"),i(),r(10,"th"),c(11,"Status"),i(),r(12,"th"),c(13,"Actions"),i()()(),r(14,"tbody"),v(15,je,12,6,"tr",29),i()()),a&2){let e=I(1),n=S();l("nzData",n.openRequests)("nzPageSize",5),s(15),l("ngForOf",e.data)}}function Ae(a,t){a&1&&d(0,"nz-empty",38)}var Ee=class a{constructor(t,e,n,o,m,u){this.itemService=t;this.locationService=e;this.inventoryService=n;this.transferService=o;this.partRequestService=m;this.reservationService=u}lowStockItems=[];openTransfers=[];openRequests=[];backorderedCount=0;ngOnInit(){this.loadData()}loadData(){this.lowStockItems=this.inventoryService.getLowStockItems(),this.openTransfers=this.transferService.getOpenTransfers(),this.openRequests=this.partRequestService.getOpenRequests(),this.backorderedCount=this.reservationService.getBackorderedReservations().length}getLocationName(t){return this.locationService.getById(t)?.name||t}getItemName(t){return this.itemService.getById(t)?.name||t}getTransferStatusColor(t){return{DRAFT:"default",PICKING:"processing",SHIPPED:"cyan",RECEIVED:"green",CANCELLED:"red"}[t]||"default"}getTransferStatusLabel(t){return fe[t]||t}getRequestStatusColor(t){return{REQUESTED:"gold",APPROVED:"blue",ALLOCATED:"cyan",TRANSFER_CREATED:"processing",FULFILLED:"green",REJECTED:"red",BACKORDERED:"volcano"}[t]||"default"}getRequestStatusLabel(t){return ge[t]||t}approveRequest(t){this.partRequestService.approve(t.id),this.loadData()}static \u0275fac=function(e){return new(e||a)(g(ze),g(C),g(b),g(D),g(q),g(E))};static \u0275cmp=O({type:a,selectors:[["app-inventory-dashboard"]],decls:40,vars:28,consts:[["lowStockExtra",""],["transfersExtra",""],["lowStockTable",""],["transferTable",""],["requestTable",""],[1,"inventory-dashboard"],[1,"page-header"],[1,"header-actions"],["nz-button","","routerLink","/inventory/items"],["nz-icon","","nzType","appstore"],["nz-button","","routerLink","/inventory/locations"],["nz-icon","","nzType","environment"],["nz-button","","routerLink","/inventory/transfers"],["nz-icon","","nzType","swap"],["nz-row","",1,"kpi-row",3,"nzGutter"],["nz-col","",3,"nzSpan"],["nzTitle","Low Stock Items",3,"nzValue","nzValueStyle"],["nzTitle","Open Transfers",3,"nzValue","nzValueStyle"],["nzTitle","Open Part Requests",3,"nzValue","nzValueStyle"],["nzTitle","Backordered",3,"nzValue","nzValueStyle"],["nzTitle","Low Stock Items",1,"section-card",3,"nzExtra"],["nzSize","small",3,"nzData","nzPageSize",4,"ngIf"],["nzNotFoundContent","No low stock items",4,"ngIf"],["nzTitle","Open Transfers",1,"section-card",3,"nzExtra"],["nzNotFoundContent","No open transfers",4,"ngIf"],["nzTitle","Open Part Requests",1,"section-card"],["nzNotFoundContent","No open requests",4,"ngIf"],["nz-button","","nzType","link","nzSize","small","routerLink","/inventory/items"],["nzSize","small",3,"nzData","nzPageSize"],[4,"ngFor","ngForOf"],[3,"nzColor"],["nzStatus","error",3,"nzText"],["nzNotFoundContent","No low stock items"],["nz-button","","nzType","link","nzSize","small","routerLink","/inventory/transfers"],["routerLink","/inventory/transfers"],["nzNotFoundContent","No open transfers"],["nz-button","","nzType","link","nzSize","small",3,"click",4,"ngIf"],["nz-button","","nzType","link","nzSize","small",3,"click"],["nzNotFoundContent","No open requests"]],template:function(e,n){if(e&1&&(r(0,"div",5)(1,"div",6)(2,"h2"),c(3,"Inventory Dashboard"),i(),r(4,"div",7)(5,"button",8),d(6,"span",9),c(7," Items"),i(),r(8,"button",10),d(9,"span",11),c(10," Locations"),i(),r(11,"button",12),d(12,"span",13),c(13," Transfers"),i()()(),r(14,"div",14)(15,"div",15)(16,"nz-card"),d(17,"nz-statistic",16),i()(),r(18,"div",15)(19,"nz-card"),d(20,"nz-statistic",17),i()(),r(21,"div",15)(22,"nz-card"),d(23,"nz-statistic",18),i()(),r(24,"div",15)(25,"nz-card"),d(26,"nz-statistic",19),i()()(),r(27,"nz-card",20),v(28,xe,2,0,"ng-template",null,0,k)(30,De,16,3,"nz-table",21)(31,qe,1,0,"nz-empty",22),i(),r(32,"nz-card",23),v(33,ke,2,0,"ng-template",null,1,k)(35,Ne,14,3,"nz-table",21)(36,Pe,1,0,"nz-empty",24),i(),r(37,"nz-card",25),v(38,we,16,3,"nz-table",21)(39,Ae,1,0,"nz-empty",26),i()()),e&2){let o=I(29),m=I(34);s(14),l("nzGutter",16),s(),l("nzSpan",6),s(2),l("nzValue",n.lowStockItems.length)("nzValueStyle",x(21,L,n.lowStockItems.length>0?"#ff4d4f":"#52c41a")),s(),l("nzSpan",6),s(2),l("nzValue",n.openTransfers.length)("nzValueStyle",F(23,_e)),s(),l("nzSpan",6),s(2),l("nzValue",n.openRequests.length)("nzValueStyle",x(24,L,n.openRequests.length>0?"#faad14":"#52c41a")),s(),l("nzSpan",6),s(2),l("nzValue",n.backorderedCount)("nzValueStyle",x(26,L,n.backorderedCount>0?"#ff4d4f":"#52c41a")),s(),l("nzExtra",o),s(3),l("ngIf",n.lowStockItems.length>0),s(),l("ngIf",n.lowStockItems.length===0),s(),l("nzExtra",m),s(3),l("ngIf",n.openTransfers.length>0),s(),l("ngIf",n.openTransfers.length===0),s(2),l("ngIf",n.openRequests.length>0),s(),l("ngIf",n.openRequests.length===0)}},dependencies:[M,B,V,U,Y,X,ue,ce,ae,oe,me,se,le,pe,de,ne,te,Z,ee,$,Q,H,J,G,W,K,Se,ve,ie,re],styles:[".inventory-dashboard[_ngcontent-%COMP%]{padding:0}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.header-actions[_ngcontent-%COMP%]{display:flex;gap:8px}.kpi-row[_ngcontent-%COMP%], .section-card[_ngcontent-%COMP%]{margin-bottom:16px}"]})};export{Ee as InventoryDashboardComponent};
