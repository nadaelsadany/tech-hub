import{a as Fe,c as Ke}from"./chunk-YHWMJEPN.js";import{a as $e}from"./chunk-T3X7QM7L.js";import{a as We}from"./chunk-LAGV6VRJ.js";import{b as A}from"./chunk-UM6B7XYO.js";import{a as B}from"./chunk-NAJWCQTC.js";import{b as Le}from"./chunk-IG52HGJK.js";import{c as ue,d as he}from"./chunk-F3IDZWT3.js";import{b as Ae}from"./chunk-4EU5S7LO.js";import{a as Z,b as ee,d as ze,e as Ee,f as je}from"./chunk-53AZ54VS.js";import{d as Ne}from"./chunk-WESEQCCP.js";import"./chunk-GC2JCOQQ.js";import{a as ke,b as Ie}from"./chunk-2QDM327Y.js";import{c as ve}from"./chunk-H5EFK6NK.js";import{g as be,h as we,j as De,k as Ce,o as Oe,p as Te,q as Me}from"./chunk-Y4SKA4DN.js";import{a as Pe,c as ye}from"./chunk-LF3AIU6I.js";import"./chunk-OX3V4ML4.js";import{d as me}from"./chunk-6RCJUTWS.js";import{g as Se,j as xe,q as _e}from"./chunk-YLQVLZ7P.js";import"./chunk-CN3ZPC5G.js";import"./chunk-4VDSMCYZ.js";import{Ha as ge,Ia as fe,j as ce,k as de,p as pe}from"./chunk-7ENSWGND.js";import{Ac as Q,Bc as X,Cc as Y,Sb as g,Sc as G,Tb as o,Ub as s,V as F,Vb as M,a as te,aa as K,ac as V,b as ne,bb as r,ea as N,fc as E,h as ie,hc as x,i as J,la as O,lb as z,ma as T,rb as oe,rc as R,sc as se,tc as le,u as ae,v as re,wc as p,xb as w,xc as P,yc as W,zc as $}from"./chunk-WBOJ7OJP.js";var U=class i{constructor(t){this.stateService=t;this.unplannedOrders$=re([this.stateService.workOrders$,this.day$,this.plans$]).pipe(ae(([e,n,a])=>{let l=new Set;return a.forEach(c=>{c.stops.forEach(_=>l.add(_.workOrderId))}),e.filter(c=>(c.status==="New"||c.status==="Ready")&&!l.has(c.id))}))}selectedDateSubject=new J(this.getTodayDate());day$=this.selectedDateSubject.asObservable();plansSubject=new J(new Map);plans$=this.plansSubject.asObservable();previousPlansSnapshot=null;unplannedOrders$;getTodayDate(){return new Date().toISOString().split("T")[0]}setDate(t){this.selectedDateSubject.next(t),this.plansSubject.next(new Map)}getDate(){return this.selectedDateSubject.value}getPlans(){return this.plansSubject.value}setPlans(t){this.plansSubject.next(t)}updatePlan(t,e){let n=new Map(this.plansSubject.value);n.set(t,e),this.plansSubject.next(n)}saveSnapshot(){this.previousPlansSnapshot=new Map(this.plansSubject.value)}restoreSnapshot(){return this.previousPlansSnapshot?(this.plansSubject.next(this.previousPlansSnapshot),this.previousPlansSnapshot=null,!0):!1}static \u0275fac=function(e){return new(e||i)(N(A))};static \u0275prov=K({token:i,factory:i.\u0275fac,providedIn:"root"})};var H=class i{constructor(t,e,n){this.geoService=t;this.configService=e;this.stateService=n}async buildGreedyPlan(t,e,n){let a=this.configService.getConfig(),l=a.planningAvgSpeedKmh||a.avgSpeedKmh,c=a.defaultServiceTimeMin,_=new Map;n.filter(m=>m.active&&m.shiftStatus==="On").forEach(m=>{_.set(m.id,{date:t,technicianId:m.id,stops:[],totalDistanceKm:0,totalTravelMin:0,totalServiceMin:0,warnings:[]})});let D={Urgent:0,High:1,Normal:2,Low:3},k=[...e].sort((m,u)=>{let h=D[m.priority]??2,S=D[u.priority]??2;if(h!==S)return h-S;let f=m.timeWindow?.start?new Date(m.timeWindow.start).getTime():1/0,v=u.timeWindow?.start?new Date(u.timeWindow.start).getTime():1/0;return f-v});for(let m of k){if(m.lockedInPlan&&m.assignedTechnicianId)continue;let u=null,h=-1,S=1/0;for(let[f,v]of _){let C=n.find(b=>b.id===f);if(C)for(let b=0;b<=v.stops.length;b++){let d=this.evaluateInsertion(v,b,m,C,l,c,t);d.feasible&&d.addedTravelMin<S&&(u=f,h=b,S=d.addedTravelMin)}}if(u&&h>=0){let f=_.get(u),v=n.find(C=>C.id===u);this.insertStop(f,h,m,v,l,c,t),_.set(u,f)}}for(let[m,u]of _){let h=n.find(S=>S.id===m);h&&this.recalcPlan(u,h,l,c,t)}return _}evaluateInsertion(t,e,n,a,l,c,_){let D=[],k=n.serviceTimeMin||c,m,u;if(e===0)m=a.startLocation?.lat??a.currentGeo.lat,u=a.startLocation?.lng??a.currentGeo.lng;else{let d=this.stateService.getWorkOrder(t.stops[e-1].workOrderId);if(!d)return{feasible:!1,addedTravelMin:1/0,addedDistanceKm:0,violations:["Previous order not found"]};m=d.address.lat,u=d.address.lng}let h=this.geoService.getDistanceKm(m,u,n.address.lat,n.address.lng),S=Math.round(h/l*60),f;if(e===0){let d=a.shift?.start?new Date(a.shift.start):new Date(`${_}T08:00:00`);f=new Date(d.getTime()+S*60*1e3)}else{let d=t.stops[e-1],y=new Date(d.endServiceAt);f=new Date(y.getTime()+S*60*1e3)}if(n.timeWindow){let d=new Date(n.timeWindow.start),y=new Date(n.timeWindow.end);f<d&&(f=d),f>y&&D.push("Time window violation")}let v=new Date(f.getTime()+k*60*1e3);if(a.shift?.end){let d=new Date(a.shift.end);v>d&&D.push("Shift overflow")}if(a.breaks)for(let d of a.breaks){let y=new Date(d.start),I=new Date(d.end);f<I&&v>y&&D.push("Break overlap")}let C=S,b=h;if(e<t.stops.length){let d=this.stateService.getWorkOrder(t.stops[e].workOrderId);if(d){let y=t.stops[e].distanceFromPrevKm,I=t.stops[e].travelMin,j=this.geoService.getDistanceKm(n.address.lat,n.address.lng,d.address.lat,d.address.lng),L=Math.round(j/l*60);C=S+L-I,b=h+j-y}}return{feasible:D.length===0,addedTravelMin:C,addedDistanceKm:b,violations:D}}insertStop(t,e,n,a,l,c,_){let D=n.serviceTimeMin||c,k,m,u;if(e===0)k=a.startLocation?.lat??a.currentGeo.lat,m=a.startLocation?.lng??a.currentGeo.lng,u=a.shift?.start?new Date(a.shift.start):new Date(`${_}T08:00:00`);else{let d=this.stateService.getWorkOrder(t.stops[e-1].workOrderId);k=d.address.lat,m=d.address.lng,u=new Date(t.stops[e-1].endServiceAt)}let h=this.geoService.getDistanceKm(k,m,n.address.lat,n.address.lng),S=Math.round(h/l*60),f=new Date(u.getTime()+S*60*1e3),v=f;if(n.timeWindow?.start){let d=new Date(n.timeWindow.start);f<d&&(v=d)}let C=new Date(v.getTime()+D*60*1e3),b={workOrderId:n.id,eta:f.toISOString(),startServiceAt:v.toISOString(),endServiceAt:C.toISOString(),distanceFromPrevKm:h,travelMin:S};t.stops.splice(e,0,b)}recalcPlan(t,e,n,a,l){let c=this.configService.getConfig(),_=n??c.planningAvgSpeedKmh??c.avgSpeedKmh,D=a??c.defaultServiceTimeMin,k=l??t.date;t.warnings=[],t.totalDistanceKm=0,t.totalTravelMin=0,t.totalServiceMin=0;let m=e.startLocation?.lat??e.currentGeo.lat,u=e.startLocation?.lng??e.currentGeo.lng,h=e.shift?.start?new Date(e.shift.start):new Date(`${k}T08:00:00`);for(let S=0;S<t.stops.length;S++){let f=t.stops[S],v=this.stateService.getWorkOrder(f.workOrderId);if(!v)continue;let C=v.serviceTimeMin||D,b=this.geoService.getDistanceKm(m,u,v.address.lat,v.address.lng),d=Math.round(b/_*60),y=new Date(h.getTime()+d*60*1e3),I=y;if(v.timeWindow?.start){let L=new Date(v.timeWindow.start);y<L&&(I=L);let q=new Date(v.timeWindow.end);I>q&&t.warnings.push(`${v.number}: Time window violation`)}let j=new Date(I.getTime()+C*60*1e3);if(e.shift?.end){let L=new Date(e.shift.end);if(j>L){let q=Math.round((j.getTime()-L.getTime())/6e4);t.warnings.push(`Shift overflow by ${q} min`)}}f.eta=y.toISOString(),f.startServiceAt=I.toISOString(),f.endServiceAt=j.toISOString(),f.distanceFromPrevKm=b,f.travelMin=d,t.totalDistanceKm+=b,t.totalTravelMin+=d,t.totalServiceMin+=C,m=v.address.lat,u=v.address.lng,h=j}return t}commitPlan(t){for(let[e,n]of t)for(let a of n.stops){let l=this.stateService.getWorkOrder(a.workOrderId);if(l){let c=ne(te({},l),{status:"Assigned",assignedTechnicianId:e,scheduledStartAt:a.startServiceAt});this.stateService.updateWorkOrder(c)}}}static \u0275fac=function(e){return new(e||i)(N(We),N(B),N(A))};static \u0275prov=K({token:i,factory:i.\u0275fac,providedIn:"root"})};function qe(i,t){if(i&1&&(o(0,"nz-tag"),p(1),s()),i&2){let e=x();r(),P(e.unplannedOrders.length)}}function Je(i,t){i&1&&(o(0,"div",33),M(1,"nz-empty",34),s())}function Qe(i,t){i&1&&(o(0,"span",46),p(1,"Warranty"),s())}function Xe(i,t){if(i&1&&(o(0,"span",47),p(1),s()),i&2){let e=x().$implicit,n=x();r(),$(" ",n.formatTime(e.timeWindow.start)," - ",n.formatTime(e.timeWindow.end)," ")}}function Ye(i,t){if(i&1&&(o(0,"div",35)(1,"div",36)(2,"span",37),p(3),s(),o(4,"nz-tag",38),p(5),s()(),o(6,"div",39),p(7),s(),o(8,"div",40)(9,"span"),p(10),s(),w(11,Qe,2,0,"span",41),s(),o(12,"div",42),w(13,Xe,2,2,"span",43),o(14,"span",44),p(15),s()(),o(16,"div",45),p(17),s()()),i&2){let e=t.$implicit,n=x();g("cdkDragData",e)("cdkDragDisabled",e.lockedInPlan),r(3),P(e.number),r(),g("nzColor",n.getPriorityColor(e.priority)),r(),P(e.priority),r(2),P((e.customer==null?null:e.customer.name)||"N/A"),r(3),P(e.category),r(),g("ngIf",e.warranty),r(2),g("ngIf",e.timeWindow),r(2),W("",e.serviceTimeMin||45," min"),r(2),P(e.address.city||e.address.line1)}}function Ze(i,t){if(i&1&&(o(0,"span",58),p(1),s()),i&2){let e=x(2).$implicit,n=x();r(),$(" ",n.formatTime(e.technician.shift.start)," - ",n.formatTime(e.technician.shift.end)," ")}}function et(i,t){if(i&1&&(o(0,"div",55)(1,"span",56),p(2),s(),w(3,Ze,2,2,"span",57),s()),i&2){let e=x().$implicit;r(2),P(e.technician.name),r(),g("ngIf",e.technician.shift)}}function tt(i,t){if(i&1&&(o(0,"nz-tag",59),p(1),s()),i&2){let e=x().$implicit;r(),W("",e.orders.length," jobs")}}function nt(i,t){i&1&&(o(0,"div",60),M(1,"span",61),o(2,"p"),p(3,"Drop jobs here"),s()())}function it(i,t){if(i&1&&(o(0,"div",70)(1,"span",71),p(2),s(),o(3,"span",72),p(4),s()()),i&2){let e=t.ngIf,n=x(3);r(2),W("ETA: ",n.formatTime(e.eta)),r(2),$("",n.formatTime(e.startServiceAt)," - ",n.formatTime(e.endServiceAt))}}function at(i,t){i&1&&(o(0,"nz-tag",73),p(1,"Window Violation"),s())}function rt(i,t){i&1&&(o(0,"nz-tag",74),p(1,"Shift Overflow"),s())}function ot(i,t){if(i&1){let e=V();o(0,"div",62)(1,"div",36)(2,"span",63),p(3),s(),o(4,"span",37),p(5),s(),o(6,"button",64),E("click",function(a){let l=O(e).$implicit,c=x(2);return T(c.toggleLock(l,a))}),M(7,"span",65),s()(),o(8,"div",39),p(9),s(),w(10,it,5,3,"div",66),o(11,"div",67),w(12,at,2,0,"nz-tag",68)(13,rt,2,0,"nz-tag",69),s()()}if(i&2){let e=t.$implicit,n=t.index,a=x().$implicit,l=x();g("cdkDragData",e)("cdkDragDisabled",e.lockedInPlan),r(3),P(n+1),r(2),P(e.number),r(),le("locked",e.lockedInPlan),r(),g("nzType",e.lockedInPlan?"lock":"unlock"),r(2),P((e.customer==null?null:e.customer.name)||"N/A"),r(),g("ngIf",l.getStopInfo(a.plan,e.id)),r(2),g("ngIf",l.hasTimeWindowViolation(a.plan,e)),r(),g("ngIf",l.hasShiftOverflow(a.plan,e))}}function st(i,t){if(i&1&&(o(0,"div",75)(1,"span"),p(2),s(),o(3,"span"),p(4),s(),o(5,"span"),p(6),s()()),i&2){let e=x().$implicit;r(2),W("",e.plan.totalDistanceKm.toFixed(1)," km"),r(2),W("",e.plan.totalTravelMin," min travel"),r(2),W("",e.plan.totalServiceMin," min service")}}function lt(i,t){if(i&1&&(o(0,"nz-tag",78),p(1),s()),i&2){let e=t.$implicit;r(),P(e)}}function ct(i,t){if(i&1&&(o(0,"div",76),w(1,lt,2,1,"nz-tag",77),s()),i&2){let e=x().$implicit;r(),g("ngForOf",e.plan.warnings)}}function dt(i,t){if(i&1){let e=V();o(0,"div",48)(1,"nz-card",49),w(2,et,4,2,"ng-template",null,2,G)(4,tt,2,1,"ng-template",null,3,G),o(6,"div",50),E("cdkDropListDropped",function(a){let l=O(e).$implicit,c=x();return T(c.dropToLane(a,l))}),w(7,nt,4,0,"div",51)(8,ot,14,11,"div",52),s(),w(9,st,7,3,"div",53)(10,ct,2,1,"div",54),s()()}if(i&2){let e=t.$implicit,n=R(3),a=R(5),l=x();r(),g("nzTitle",n)("nzExtra",a),r(5),g("id","lane-"+e.technician.id)("cdkDropListData",e.orders)("cdkDropListConnectedTo",l.getAllConnectedLists(e.technician.id)),r(),g("ngIf",e.orders.length===0),r(),g("ngForOf",e.orders),r(),g("ngIf",e.plan),r(),g("ngIf",e.plan==null||e.plan.warnings==null?null:e.plan.warnings.length)}}function pt(i,t){if(i&1&&(o(0,"div",79),M(1,"span",80),o(2,"span"),p(3),s()()),i&2){let e=t.$implicit,n=x();r(),se("background",n.getTechColor(e.technician.id)),r(2),$("",e.technician.name," (",e.orders.length," stops)")}}var Ge=class i{constructor(t,e,n,a,l,c,_){this.planningState=t;this.planningEngine=e;this.stateService=n;this.configService=a;this.message=l;this.notification=c;this.router=_}destroy$=new ie;selectedDate=new Date;selectedSite="SITE-001";optimizing=!1;unplannedOrders=[];lanes=[];laneIds=[];technicians=[];techColors=["#1890ff","#52c41a","#fa8c16","#eb2f96","#722ed1"];get hasPlannedOrders(){return this.lanes.some(t=>t.orders.length>0)}ngOnInit(){this.stateService.technicians$.pipe(F(this.destroy$)).subscribe(t=>{this.technicians=t.filter(e=>e.active&&e.shiftStatus==="On"),this.initializeLanes()}),this.planningState.unplannedOrders$.pipe(F(this.destroy$)).subscribe(t=>{this.unplannedOrders=t}),this.planningState.plans$.pipe(F(this.destroy$)).subscribe(t=>{this.updateLanesFromPlans(t)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initializeLanes(){this.lanes=this.technicians.map(t=>({technician:t,plan:{date:this.planningState.getDate(),technicianId:t.id,stops:[],totalDistanceKm:0,totalTravelMin:0,totalServiceMin:0,warnings:[]},orders:[]})),this.laneIds=this.lanes.map(t=>"lane-"+t.technician.id)}updateLanesFromPlans(t){for(let e of this.lanes){let n=t.get(e.technician.id);n?(e.plan=n,e.orders=n.stops.map(a=>this.stateService.getWorkOrder(a.workOrderId)).filter(a=>!!a)):(e.plan={date:this.planningState.getDate(),technicianId:e.technician.id,stops:[],totalDistanceKm:0,totalTravelMin:0,totalServiceMin:0,warnings:[]},e.orders=[])}}onDateChange(t){if(t){let e=t.toISOString().split("T")[0];this.planningState.setDate(e)}}async optimizeDay(){this.optimizing=!0,this.planningState.saveSnapshot();try{let t=await this.planningEngine.buildGreedyPlan(this.planningState.getDate(),this.unplannedOrders,this.technicians);this.planningState.setPlans(t),this.message.success("Optimization complete!")}catch{this.message.error("Optimization failed")}finally{this.optimizing=!1}}recalcETAs(){let t=this.configService.getConfig(),e=t.planningAvgSpeedKmh||t.avgSpeedKmh,n=t.defaultServiceTimeMin,a=this.planningState.getDate();for(let l of this.lanes)l.orders.length>0&&(l.plan.stops=l.orders.map(c=>({workOrderId:c.id,eta:"",startServiceAt:"",endServiceAt:"",distanceFromPrevKm:0,travelMin:0})),this.planningEngine.recalcPlan(l.plan,l.technician,e,n,a),this.planningState.updatePlan(l.technician.id,l.plan));this.message.info("ETAs recalculated")}commitPlan(){this.planningState.saveSnapshot();let t=this.planningState.getPlans();this.planningEngine.commitPlan(t),this.notification.success("Plan Committed",`${this.getTotalPlannedCount()} jobs assigned to ${t.size} technicians`),this.router.navigate(["/orders"])}getTotalPlannedCount(){return this.lanes.reduce((t,e)=>t+e.orders.length,0)}dropToUnplanned(t){t.previousContainer===t.container?Z(t.container.data,t.previousIndex,t.currentIndex):(ee(t.previousContainer.data,t.container.data,t.previousIndex,t.currentIndex),this.syncLanesToState())}dropToLane(t,e){t.previousContainer===t.container?Z(e.orders,t.previousIndex,t.currentIndex):ee(t.previousContainer.data,e.orders,t.previousIndex,t.currentIndex),this.syncLanesToState(),this.recalcSingleLane(e)}syncLanesToState(){let t=new Map;for(let e of this.lanes)e.plan.stops=e.orders.map(n=>({workOrderId:n.id,eta:"",startServiceAt:"",endServiceAt:"",distanceFromPrevKm:0,travelMin:0})),t.set(e.technician.id,e.plan);this.planningState.setPlans(t)}recalcSingleLane(t){let e=this.configService.getConfig();this.planningEngine.recalcPlan(t.plan,t.technician,e.planningAvgSpeedKmh||e.avgSpeedKmh,e.defaultServiceTimeMin,this.planningState.getDate()),this.planningState.updatePlan(t.technician.id,t.plan)}getAllConnectedLists(t){return["unplannedList",...this.laneIds.filter(e=>e!=="lane-"+t)]}toggleLock(t,e){e.stopPropagation(),t.lockedInPlan=!t.lockedInPlan,this.stateService.updateWorkOrder(t)}getPriorityColor(t){return{Low:"success",Normal:"processing",High:"warning",Urgent:"error"}[t]||"default"}formatTime(t){return t?new Date(t).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"--:--"}getStopInfo(t,e){return t.stops.find(n=>n.workOrderId===e)}hasTimeWindowViolation(t,e){return t.warnings?.some(n=>n.includes(e.number)&&n.includes("Time window"))??!1}hasShiftOverflow(t,e){return t.warnings?.some(n=>n.includes("Shift overflow"))??!1}getTechColor(t){let e=this.technicians.findIndex(n=>n.id===t);return this.techColors[e%this.techColors.length]}static \u0275fac=function(e){return new(e||i)(z(U),z(H),z(A),z(B),z(Ne),z($e),z(me))};static \u0275cmp=oe({type:i,selectors:[["app-planning"]],decls:40,vars:12,consts:[["unplannedExtra",""],["unplannedList","cdkDropList"],["laneTitle",""],["laneExtra",""],[1,"planning-container"],[1,"planning-header"],[1,"header-left"],[3,"ngModelChange","ngModel","nzAllowClear"],[2,"width","150px","margin-left","12px",3,"ngModelChange","ngModel"],["nzValue","SITE-001","nzLabel","Site 001"],[1,"header-right"],["nz-button","","nzType","primary",3,"click","nzLoading"],["nz-icon","","nzType","thunderbolt"],["nz-button","",2,"margin-left","8px",3,"click"],["nz-icon","","nzType","sync"],["nz-button","","nzType","default","nzDanger","",2,"margin-left","8px",3,"click","disabled"],["nz-icon","","nzType","check-circle"],[1,"planning-body"],[1,"unplanned-column"],["nzTitle","Unplanned Orders",1,"panel-card",3,"nzExtra"],["cdkDropList","",1,"job-list",3,"cdkDropListDropped","cdkDropListData","cdkDropListConnectedTo"],["class","empty-state",4,"ngIf"],["cdkDrag","","class","job-card",3,"cdkDragData","cdkDragDisabled",4,"ngFor","ngForOf"],[1,"lanes-column"],[1,"lanes-wrapper"],["class","tech-lane",4,"ngFor","ngForOf"],[1,"map-column"],["nzTitle","Route Map",1,"panel-card","map-card"],[1,"map-placeholder"],["nz-icon","","nzType","environment","nzTheme","outline",2,"font-size","48px","color","#ccc"],[1,"map-hint"],[1,"route-legend"],["class","legend-item",4,"ngFor","ngForOf"],[1,"empty-state"],["nzNotFoundContent","All orders planned!"],["cdkDrag","",1,"job-card",3,"cdkDragData","cdkDragDisabled"],[1,"job-header"],[1,"job-number"],["nzMode","default",3,"nzColor"],[1,"job-customer"],[1,"job-details"],["class","warranty-badge",4,"ngIf"],[1,"job-meta"],["class","time-window",4,"ngIf"],[1,"service-time"],[1,"job-location"],[1,"warranty-badge"],[1,"time-window"],[1,"tech-lane"],[1,"lane-card",3,"nzTitle","nzExtra"],["cdkDropList","",1,"job-list","lane-list",3,"cdkDropListDropped","id","cdkDropListData","cdkDropListConnectedTo"],["class","empty-lane",4,"ngIf"],["cdkDrag","","class","job-card planned-card",3,"cdkDragData","cdkDragDisabled",4,"ngFor","ngForOf"],["class","lane-footer",4,"ngIf"],["class","lane-warnings",4,"ngIf"],[1,"lane-header-content"],[1,"tech-name"],["class","tech-shift",4,"ngIf"],[1,"tech-shift"],["nzColor","blue"],[1,"empty-lane"],["nz-icon","","nzType","inbox","nzTheme","outline"],["cdkDrag","",1,"job-card","planned-card",3,"cdkDragData","cdkDragDisabled"],[1,"stop-number"],["nz-button","","nzType","text","nzSize","small",3,"click"],["nz-icon","",3,"nzType"],["class","job-times",4,"ngIf"],[1,"job-violations"],["nzColor","red",4,"ngIf"],["nzColor","volcano",4,"ngIf"],[1,"job-times"],[1,"eta"],[1,"service"],["nzColor","red"],["nzColor","volcano"],[1,"lane-footer"],[1,"lane-warnings"],["nzColor","warning",4,"ngFor","ngForOf"],["nzColor","warning"],[1,"legend-item"],[1,"legend-dot"]],template:function(e,n){if(e&1){let a=V();o(0,"div",4)(1,"div",5)(2,"div",6)(3,"h2"),p(4,"Daily Planning"),s(),o(5,"nz-date-picker",7),Y("ngModelChange",function(c){return O(a),X(n.selectedDate,c)||(n.selectedDate=c),T(c)}),E("ngModelChange",function(c){return O(a),T(n.onDateChange(c))}),s(),o(6,"nz-select",8),Y("ngModelChange",function(c){return O(a),X(n.selectedSite,c)||(n.selectedSite=c),T(c)}),M(7,"nz-option",9),s()(),o(8,"div",10)(9,"button",11),E("click",function(){return O(a),T(n.optimizeDay())}),M(10,"span",12),p(11," Optimize Day "),s(),o(12,"button",13),E("click",function(){return O(a),T(n.recalcETAs())}),M(13,"span",14),p(14," Recalculate ETAs "),s(),o(15,"button",15),E("click",function(){return O(a),T(n.commitPlan())}),M(16,"span",16),p(17," Commit Plan "),s()()(),o(18,"div",17)(19,"div",18)(20,"nz-card",19),w(21,qe,2,1,"ng-template",null,0,G),o(23,"div",20,1),E("cdkDropListDropped",function(c){return O(a),T(n.dropToUnplanned(c))}),w(25,Je,2,0,"div",21)(26,Ye,18,11,"div",22),s()()(),o(27,"div",23)(28,"div",24),w(29,dt,11,9,"div",25),s()(),o(30,"div",26)(31,"nz-card",27)(32,"div",28),M(33,"span",29),o(34,"p"),p(35,"Map preview coming soon"),s(),o(36,"p",30),p(37,"Integrate Azure Maps or Google Maps"),s()(),o(38,"div",31),w(39,pt,4,4,"div",32),s()()()()()}if(e&2){let a=R(22);r(5),Q("ngModel",n.selectedDate),g("nzAllowClear",!1),r(),Q("ngModel",n.selectedSite),r(3),g("nzLoading",n.optimizing),r(6),g("disabled",!n.hasPlannedOrders),r(5),g("nzExtra",a),r(3),g("cdkDropListData",n.unplannedOrders)("cdkDropListConnectedTo",n.laneIds),r(2),g("ngIf",n.unplannedOrders.length===0),r(),g("ngForOf",n.unplannedOrders),r(3),g("ngForOf",n.lanes),r(10),g("ngForOf",n.lanes)}},dependencies:[pe,ce,de,_e,Se,xe,je,Ee,ze,he,ue,Ce,De,be,we,Ke,Fe,Me,Oe,Te,Ie,ke,fe,ge,Ae,Le,ye,Pe,ve],styles:[".planning-container[_ngcontent-%COMP%]{height:calc(100vh - 120px);display:flex;flex-direction:column}.planning-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 0;border-bottom:1px solid #f0f0f0;margin-bottom:16px}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.header-left[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.header-right[_ngcontent-%COMP%]{display:flex;gap:8px}.planning-body[_ngcontent-%COMP%]{display:flex;flex:1;gap:16px;overflow:hidden}.unplanned-column[_ngcontent-%COMP%]{width:280px;flex-shrink:0}.lanes-column[_ngcontent-%COMP%]{flex:1;overflow-x:auto}.map-column[_ngcontent-%COMP%]{width:300px;flex-shrink:0}.panel-card[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.panel-card[_ngcontent-%COMP%]     .ant-card-body{flex:1;overflow-y:auto;padding:12px}.lanes-wrapper[_ngcontent-%COMP%]{display:flex;gap:16px;height:100%;min-width:max-content}.tech-lane[_ngcontent-%COMP%]{width:280px;flex-shrink:0}.lane-card[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.lane-card[_ngcontent-%COMP%]     .ant-card-body{flex:1;overflow-y:auto;padding:8px}.lane-header-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}.tech-name[_ngcontent-%COMP%]{font-weight:600}.tech-shift[_ngcontent-%COMP%]{font-size:12px;color:#888}.job-list[_ngcontent-%COMP%]{min-height:100px}.lane-list[_ngcontent-%COMP%]{min-height:200px;background:#fafafa;border-radius:4px;padding:8px}.job-card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e8e8e8;border-radius:6px;padding:10px;margin-bottom:8px;cursor:grab;transition:box-shadow .2s}.job-card[_ngcontent-%COMP%]:hover{box-shadow:0 2px 8px #0000001a}.job-card.cdk-drag-placeholder[_ngcontent-%COMP%]{background:#f0f0f0;border:2px dashed #1890ff}.job-card.cdk-drag-preview[_ngcontent-%COMP%]{box-shadow:0 4px 16px #0003}.planned-card[_ngcontent-%COMP%]{border-left:3px solid #1890ff}.job-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:4px}.stop-number[_ngcontent-%COMP%]{width:20px;height:20px;border-radius:50%;background:#1890ff;color:#fff;font-size:11px;display:flex;align-items:center;justify-content:center}.job-number[_ngcontent-%COMP%]{font-weight:600;flex:1}.job-customer[_ngcontent-%COMP%]{font-size:13px;color:#333;margin-bottom:4px}.job-details[_ngcontent-%COMP%]{font-size:12px;color:#666;display:flex;gap:8px}.warranty-badge[_ngcontent-%COMP%]{color:#1890ff}.job-meta[_ngcontent-%COMP%]{font-size:11px;color:#888;display:flex;gap:12px;margin-top:4px}.time-window[_ngcontent-%COMP%]{background:#e6f7ff;padding:2px 6px;border-radius:3px}.service-time[_ngcontent-%COMP%]{background:#f0f0f0;padding:2px 6px;border-radius:3px}.job-location[_ngcontent-%COMP%]{font-size:11px;color:#999;margin-top:4px}.job-times[_ngcontent-%COMP%]{font-size:11px;color:#52c41a;margin:4px 0}.job-times[_ngcontent-%COMP%]   .eta[_ngcontent-%COMP%]{margin-right:12px}.job-violations[_ngcontent-%COMP%]{margin-top:4px}.lane-footer[_ngcontent-%COMP%]{display:flex;gap:12px;padding:8px;background:#fafafa;border-top:1px solid #f0f0f0;font-size:11px;color:#666}.lane-warnings[_ngcontent-%COMP%]{padding:4px 8px}.empty-state[_ngcontent-%COMP%], .empty-lane[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:24px;color:#999}.map-card[_ngcontent-%COMP%]     .ant-card-body{display:flex;flex-direction:column}.map-placeholder[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#fafafa;border-radius:4px;min-height:200px}.map-hint[_ngcontent-%COMP%]{font-size:11px;color:#999}.route-legend[_ngcontent-%COMP%]{padding-top:12px;border-top:1px solid #f0f0f0;margin-top:12px}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-bottom:4px;font-size:12px}.legend-dot[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%}button.locked[_ngcontent-%COMP%]{color:#faad14}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .job-card[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]})};export{Ge as PlanningComponent};
