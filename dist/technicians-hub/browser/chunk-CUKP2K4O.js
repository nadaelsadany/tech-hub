import{a as ft,b as wt,c as _t}from"./chunk-YHWMJEPN.js";import{a as K,b as G}from"./chunk-UM6B7XYO.js";import"./chunk-NAJWCQTC.js";import{a as Ne,b as Me}from"./chunk-3NY7DZAO.js";import{a as pt,b as vt}from"./chunk-IG52HGJK.js";import{c as Fe,d as Le}from"./chunk-F3IDZWT3.js";import{a as lt,b as ct,c as ut}from"./chunk-32YKJWL6.js";import{a as dt,b as mt}from"./chunk-JHEXQXAK.js";import{c as Ye,d as et,e as tt,f as nt,g as it,h as rt,i as ot}from"./chunk-H2G74B6L.js";import"./chunk-CESBHL5B.js";import"./chunk-GC2JCOQQ.js";import{a as at,b as st}from"./chunk-2QDM327Y.js";import{d as Be,e as Ue,f as je,g as qe,h as Ke,j as Ge,k as Xe,o as Ze,p as Qe,q as Je}from"./chunk-Y4SKA4DN.js";import"./chunk-LF3AIU6I.js";import"./chunk-OX3V4ML4.js";import"./chunk-5AAZBCL7.js";import{e as ye,g as Ie}from"./chunk-6RCJUTWS.js";import{a as Pe,g as $e,j as He,q as We}from"./chunk-YLQVLZ7P.js";import"./chunk-CN3ZPC5G.js";import"./chunk-4VDSMCYZ.js";import{Fa as Ve,Ga as ee,Ha as De,Ia as Ae,j as Se,ja as Y,k as be,l as xe,m as Oe,n as Te,p as Ee,w as ke,y as q}from"./chunk-7ENSWGND.js";import{$ as re,Ac as W,Bc as B,Cc as U,Da as ce,Kc as he,Lc as D,Mc as F,Pb as me,Pc as T,Qb as pe,Qc as L,Rb as ve,Rc as j,Sb as d,Sc as ze,Tb as s,Ub as l,Vb as R,Zb as x,_b as O,a as b,aa as oe,ac as S,b as y,ba as ae,bb as u,dd as Ce,f as ne,fa as h,fc as C,gd as A,hc as p,hd as Re,i as ie,kb as ue,la as w,lc as fe,ma as _,mc as we,n as Q,nc as _e,o as N,qa as se,rb as M,rc as H,sa as I,sb as de,ta as le,tc as ge,u as z,vc as J,wc as m,xb as g,xc as k,yc as V}from"./chunk-WBOJ7OJP.js";var Et=["nz-rate-item",""],gt=n=>({$implicit:n});function yt(n,t){}function It(n,t){}function kt(n,t){n&1&&R(0,"nz-icon",4)}var Vt=["ulElement"];function Dt(n,t){if(n&1){let e=S();s(0,"li",3)(1,"div",4),C("itemHover",function(r){let o=w(e).$index,v=p();return _(v.onItemHover(o,r))})("itemClick",function(r){let o=w(e).$index,v=p();return _(v.onItemClick(o,r))}),l()()}if(n&2){let e=t.$index,i=p();J(i.starStyleArray[e]||""),d("nzTooltipTitle",i.nzTooltips[e]),u(),d("allowHalf",i.nzAllowHalf)("character",i.nzCharacter)("index",e)}}var Ct=(()=>{class n{character;index=0;allowHalf=!1;itemHover=new I;itemClick=new I;hoverRate(e){this.itemHover.next(e&&this.allowHalf)}clickRate(e){this.itemClick.next(e&&this.allowHalf)}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=M({type:n,selectors:[["","nz-rate-item",""]],inputs:{character:"character",index:"index",allowHalf:[2,"allowHalf","allowHalf",A]},outputs:{itemHover:"itemHover",itemClick:"itemClick"},exportAs:["nzRateItem"],attrs:Et,decls:6,vars:8,consts:[["defaultCharacter",""],[1,"ant-rate-star-second",3,"mouseover","click"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"ant-rate-star-first",3,"mouseover","click"],["nzType","star","nzTheme","fill"]],template:function(i,r){if(i&1){let o=S();s(0,"div",1),C("mouseover",function(a){return w(o),r.hoverRate(!1),_(a.stopPropagation())})("click",function(){return w(o),_(r.clickRate(!1))}),g(1,yt,0,0,"ng-template",2),l(),s(2,"div",3),C("mouseover",function(a){return w(o),r.hoverRate(!0),_(a.stopPropagation())})("click",function(){return w(o),_(r.clickRate(!0))}),g(3,It,0,0,"ng-template",2),l(),g(4,kt,1,0,"ng-template",null,0,ze)}if(i&2){let o=H(5);u(),d("ngTemplateOutlet",r.character||o)("ngTemplateOutletContext",F(4,gt,r.index)),u(2),d("ngTemplateOutlet",r.character||o)("ngTemplateOutletContext",F(6,gt,r.index))}},dependencies:[xe,Ae,De],encapsulation:2,changeDetection:0})}return n})(),ht="rate",te=(()=>{let n,t=[],e=[],i,r=[],o=[];return class X{static{let a=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;n=[ee()],i=[ee()],Q(null,null,n,{kind:"field",name:"nzAllowClear",static:!1,private:!1,access:{has:c=>"nzAllowClear"in c,get:c=>c.nzAllowClear,set:(c,f)=>{c.nzAllowClear=f}},metadata:a},t,e),Q(null,null,i,{kind:"field",name:"nzAllowHalf",static:!1,private:!1,access:{has:c=>"nzAllowHalf"in c,get:c=>c.nzAllowHalf,set:(c,f)=>{c.nzAllowHalf=f}},metadata:a},r,o),a&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a})}_nzModuleName=ht;ngZone=h(le);renderer=h(ue);cdr=h(Ce);directionality=h(ke);destroyRef=h(se);ulElement;nzAllowClear=N(this,t,!0);nzAllowHalf=(N(this,e),N(this,r,!1));nzDisabled=(N(this,o),!1);nzAutoFocus=!1;nzCharacter;nzCount=5;nzTooltips=[];nzOnBlur=new I;nzOnFocus=new I;nzOnHoverChange=new I;nzOnKeyDown=new I;classMap={};starArray=[];starStyleArray=[];dir="ltr";hasHalf=!1;hoverValue=0;isFocused=!1;_value=0;isNzDisableFirstChange=!0;get nzValue(){return this._value}set nzValue(a){this._value!==a&&(this._value=a,this.hasHalf=!Number.isInteger(a)&&this.nzAllowHalf,this.hoverValue=Math.ceil(a))}constructor(){Ve(ht,()=>this.cdr.markForCheck())}ngOnChanges(a){let{nzAutoFocus:c,nzCount:f,nzValue:E}=a;if(c&&!c.isFirstChange()){let P=this.ulElement.nativeElement;this.nzAutoFocus&&!this.nzDisabled?this.renderer.setAttribute(P,"autofocus","autofocus"):this.renderer.removeAttribute(P,"autofocus")}f&&this.updateStarArray(),E&&this.updateStarStyle()}ngOnInit(){this.directionality.change.pipe(q(this.destroyRef)).subscribe(a=>{this.dir=a,this.cdr.detectChanges()}),this.dir=this.directionality.value,Y(this.ulElement.nativeElement,"focus").pipe(q(this.destroyRef)).subscribe(a=>{this.isFocused=!0,this.nzOnFocus.observers.length&&this.ngZone.run(()=>this.nzOnFocus.emit(a))}),Y(this.ulElement.nativeElement,"blur").pipe(q(this.destroyRef)).subscribe(a=>{this.isFocused=!1,this.nzOnBlur.observers.length&&this.ngZone.run(()=>this.nzOnBlur.emit(a))})}onItemClick(a,c){if(this.nzDisabled)return;this.hoverValue=a+1;let f=c?a+.5:a+1;this.nzValue===f?this.nzAllowClear&&(this.nzValue=0,this.onChange(this.nzValue)):(this.nzValue=f,this.onChange(this.nzValue)),this.updateStarStyle()}onItemHover(a,c){this.nzDisabled||((this.hoverValue!==a+1||c!==this.hasHalf)&&(this.hoverValue=a+1,this.hasHalf=c,this.updateStarStyle()),this.nzOnHoverChange.emit(this.hoverValue))}onRateLeave(){this.hasHalf=!Number.isInteger(this.nzValue),this.hoverValue=Math.ceil(this.nzValue),this.nzOnHoverChange.emit(this.hoverValue),this.updateStarStyle()}focus(){this.ulElement.nativeElement.focus()}blur(){this.ulElement.nativeElement.blur()}onKeyDown(a){let c=this.nzValue;a.keyCode===39&&this.nzValue<this.nzCount?this.nzValue+=this.nzAllowHalf?.5:1:a.keyCode===37&&this.nzValue>0&&(this.nzValue-=this.nzAllowHalf?.5:1),c!==this.nzValue&&(this.onChange(this.nzValue),this.nzOnKeyDown.emit(a),this.updateStarStyle(),this.cdr.markForCheck())}updateStarArray(){this.starArray=Array(this.nzCount).fill(0).map((a,c)=>c),this.updateStarStyle()}updateStarStyle(){this.starStyleArray=this.starArray.map(a=>{let c="ant-rate-star",f=a+1;return{[`${c}-full`]:f<this.hoverValue||!this.hasHalf&&f===this.hoverValue,[`${c}-half`]:this.hasHalf&&f===this.hoverValue,[`${c}-active`]:this.hasHalf&&f===this.hoverValue,[`${c}-zero`]:f>this.hoverValue,[`${c}-focused`]:this.hasHalf&&f===this.hoverValue&&this.isFocused}})}writeValue(a){this.nzValue=a||0,this.updateStarArray(),this.cdr.markForCheck()}setDisabledState(a){this.nzDisabled=this.isNzDisableFirstChange&&this.nzDisabled||a,this.isNzDisableFirstChange=!1,this.cdr.markForCheck()}registerOnChange(a){this.onChange=a}registerOnTouched(a){this.onTouched=a}onChange=()=>null;onTouched=()=>null;static \u0275fac=function(c){return new(c||X)};static \u0275cmp=M({type:X,selectors:[["nz-rate"]],viewQuery:function(c,f){if(c&1&&fe(Vt,7),c&2){let E;we(E=_e())&&(f.ulElement=E.first)}},inputs:{nzAllowClear:[2,"nzAllowClear","nzAllowClear",A],nzAllowHalf:[2,"nzAllowHalf","nzAllowHalf",A],nzDisabled:[2,"nzDisabled","nzDisabled",A],nzAutoFocus:[2,"nzAutoFocus","nzAutoFocus",A],nzCharacter:"nzCharacter",nzCount:[2,"nzCount","nzCount",Re],nzTooltips:"nzTooltips"},outputs:{nzOnBlur:"nzOnBlur",nzOnFocus:"nzOnFocus",nzOnHoverChange:"nzOnHoverChange",nzOnKeyDown:"nzOnKeyDown"},exportAs:["nzRate"],features:[he([{provide:Pe,useExisting:re(()=>X),multi:!0}]),ce],decls:4,vars:7,consts:[["ulElement",""],[1,"ant-rate",3,"keydown","mouseleave","tabindex"],["nz-tooltip","",1,"ant-rate-star",3,"class","nzTooltipTitle"],["nz-tooltip","",1,"ant-rate-star",3,"nzTooltipTitle"],["nz-rate-item","",3,"itemHover","itemClick","allowHalf","character","index"]],template:function(c,f){if(c&1){let E=S();s(0,"ul",1,0),C("keydown",function($){return w(E),f.onKeyDown($),_($.preventDefault())})("mouseleave",function($){return w(E),f.onRateLeave(),_($.stopPropagation())}),pe(2,Dt,2,6,"li",2,me),l()}c&2&&(J(f.classMap),ge("ant-rate-disabled",f.nzDisabled)("ant-rate-rtl",f.dir==="rtl"),d("tabindex",f.nzDisabled?-1:1),u(2),ve(f.starArray))},dependencies:[mt,dt,Ct],encapsulation:2,changeDetection:0})}})(),Rt=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=de({type:n});static \u0275inj=ae({imports:[te,Ct]})}return n})();var Z=class n{reviewTaskService=h(K);stateService=h(G);reviewsSubject=new ie([]);reviews$=this.reviewsSubject.asObservable();reviewsByWorkOrder$=this.reviews$.pipe(z(t=>{let e=new Map;return t.forEach(i=>e.set(i.workOrderId,i)),e}));submitReview(t){let e=this.reviewsSubject.value;this.reviewsSubject.next([...e,t]);let i=this.stateService.getWorkOrder(t.workOrderId);if(i){let r=y(b({},i),{supervisorReviewId:t.id,supervisorReviewOutcome:t.outcome,supervisorReviewedAt:t.reviewedAt});this.stateService.updateWorkOrder(r)}return this.reviewTaskService.completeReview(t.id),(t.outcome==="NeedsRework"||t.outcome==="FollowUpRequired")&&this.createFollowUpOrder(t),t}updateReview(t,e){let i=this.reviewsSubject.value,r=i.findIndex(c=>c.id===t);if(r===-1)return null;let o=y(b(b({},i[r]),e),{reviewedAt:new Date().toISOString()}),v=[...i];v[r]=o,this.reviewsSubject.next(v);let a=this.stateService.getWorkOrder(o.workOrderId);if(a){let c=y(b({},a),{supervisorReviewOutcome:o.outcome,supervisorReviewedAt:o.reviewedAt});this.stateService.updateWorkOrder(c)}return o}getByWorkOrder(t){return this.reviews$.pipe(z(e=>e.find(i=>i.workOrderId===t)))}getReviewsInPeriod(t,e){return this.reviews$.pipe(z(i=>{let r=i.filter(o=>{let v=new Date(o.reviewedAt),a=new Date(t.start),c=new Date(t.end);return v>=a&&v<=c});return e?.technicianIds&&e.technicianIds.length>0&&(r=r.filter(o=>e.technicianIds.includes(o.technicianId))),e?.supervisorIds&&e.supervisorIds.length>0&&(r=r.filter(o=>e.supervisorIds.includes(o.supervisorId))),e?.outcomes&&e.outcomes.length>0&&(r=r.filter(o=>e.outcomes.includes(o.outcome))),r}))}getAvgScoreForTechnician(t,e){return this.getReviewsInPeriod(e,{technicianIds:[t]}).pipe(z(i=>i.length===0?0:i.reduce((o,v)=>o+v.score,0)/i.length))}getReviewCoverage(t){let e=this.stateService.workOrders$.pipe(z(r=>r.filter(o=>{if(o.status!=="Completed"||!o.completedAt)return!1;let v=new Date(o.completedAt);return v>=new Date(t.start)&&v<=new Date(t.end)}))),i=this.getReviewsInPeriod(t);return new ne(r=>{let o=0,v=0;e.subscribe(a=>{o=a.length;let c=o>0?v/o*100:0;r.next(c)}),i.subscribe(a=>{v=a.length;let c=o>0?v/o*100:0;r.next(c)})})}createFollowUpOrder(t){let e=this.stateService.getWorkOrder(t.workOrderId);if(!e)return;let i=y(b({},e),{id:this.generateId(),number:this.generateOrderNumber(),status:"New",assignedTechnicianId:null,scheduledStartAt:null,etaMin:null,distanceKm:null,notes:`Follow-up for WO ${e.number}. Original review: ${t.outcome}. ${t.notes||""}`,createdAt:new Date().toISOString(),result:null,statusHistory:[],changeLog:[],supervisorReviewId:null,supervisorReviewOutcome:null,supervisorReviewedAt:null,completedAt:void 0});this.stateService.addWorkOrder(i),console.log(`Follow-up order ${i.number} created for ${e.number}`)}generateId(){return`SR-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}generateOrderNumber(){return`WO-${Date.now()}-${Math.random().toString(36).substr(2,5).toUpperCase()}`}static \u0275fac=function(e){return new(e||n)};static \u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"root"})};var St={Approved:"Approved",NeedsRework:"Needs Rework",FollowUpRequired:"Follow-Up Required",Rejected:"Rejected"},bt={Approved:"success",NeedsRework:"warning",FollowUpRequired:"processing",Rejected:"error"};var xt={PENDING:"Pending",IN_REVIEW:"In Review",COMPLETED:"Completed",EXPIRED:"Expired"},Ot={PENDING:"default",IN_REVIEW:"processing",COMPLETED:"success",EXPIRED:"error"};var Nt=()=>[],Mt=()=>({color:"#1890ff"}),Ft=()=>({color:"#cf1322"}),Lt=()=>({color:"#52c41a"}),Pt=()=>["/orders"],$t=n=>({id:n});function Ht(n,t){if(n&1&&(x(0),R(1,"nz-statistic",10),T(2,"async"),O()),n&2){let e=p();u(),d("nzValue",L(2,2,e.pendingCount$)||0)("nzValueStyle",D(4,Mt))}}function Wt(n,t){if(n&1&&(x(0),R(1,"nz-statistic",11),T(2,"async"),O()),n&2){let e=p();u(),d("nzValue",L(2,2,e.overdueCount$)||0)("nzValueStyle",D(4,Ft))}}function Bt(n,t){if(n&1&&(x(0),R(1,"nz-statistic",12),T(2,"async"),O()),n&2){let e=p();u(),d("nzValue",L(2,2,e.inReviewCount$)||0)("nzValueStyle",D(4,Lt))}}function Ut(n,t){if(n&1&&R(0,"nz-option",15),n&2){let e=t.$implicit;d("nzValue",e.value)("nzLabel",e.label)}}function jt(n,t){if(n&1){let e=S();x(0),s(1,"span"),m(2,"Status:"),l(),s(3,"nz-select",13),U("ngModelChange",function(r){w(e);let o=p();return B(o.selectedStatus,r)||(o.selectedStatus=r),_(r)}),C("ngModelChange",function(){w(e);let r=p();return _(r.onStatusFilterChange())}),g(4,Ut,1,2,"nz-option",14),l(),O()}if(n&2){let e=p();u(3),W("ngModel",e.selectedStatus),u(),d("ngForOf",e.statusOptions)}}function qt(n,t){if(n&1){let e=S();x(0),s(1,"span"),m(2,"Outcome:"),l(),s(3,"nz-select",16),U("ngModelChange",function(r){w(e);let o=p();return B(o.selectedOutcome,r)||(o.selectedOutcome=r),_(r)}),C("ngModelChange",function(){w(e);let r=p();return _(r.onOutcomeFilterChange())}),R(4,"nz-option",17)(5,"nz-option",18)(6,"nz-option",19)(7,"nz-option",20),l(),O()}if(n&2){let e=p();u(3),W("ngModel",e.selectedOutcome)}}function Kt(n,t){if(n&1){let e=S();x(0),s(1,"span"),m(2,"Completed Date:"),l(),s(3,"nz-range-picker",21),U("ngModelChange",function(r){w(e);let o=p();return B(o.dateRange,r)||(o.dateRange=r),_(r)}),C("ngModelChange",function(){w(e);let r=p();return _(r.onDateRangeChange())}),l(),O()}if(n&2){let e=p();u(3),W("ngModel",e.dateRange)}}function Gt(n,t){if(n&1){let e=S();x(0),s(1,"button",22),C("click",function(){w(e);let r=p();return _(r.clearFilters())}),m(2," Clear Filters "),l(),O()}}function Xt(n,t){if(n&1&&(s(0,"span"),m(1),T(2,"date"),l()),n&2){let e=p().$implicit;u(),V(" ",j(2,1,e.workOrder.completedAt,"MMM d, y h:mm a")," ")}}function Zt(n,t){n&1&&(s(0,"span"),m(1,"-"),l())}function Qt(n,t){n&1&&R(0,"nz-badge",30)}function Jt(n,t){if(n&1&&(s(0,"nz-tag",25),m(1),l()),n&2){let e=p().$implicit,i=p();d("nzColor",i.getOutcomeColor(e.reviewOutcome)),u(),V(" ",i.getOutcomeLabel(e.reviewOutcome)," ")}}function Yt(n,t){n&1&&(s(0,"span"),m(1,"-"),l())}function en(n,t){if(n&1&&R(0,"nz-rate",31),n&2){let e=p().$implicit;d("ngModel",e.reviewScore/20)("nzAllowHalf",!0)}}function tn(n,t){n&1&&(s(0,"span"),m(1,"-"),l())}function nn(n,t){if(n&1&&(s(0,"div"),R(1,"nz-badge",32)(2,"br"),s(3,"small",33),m(4),T(5,"date"),l()()),n&2){let e=p().$implicit,i=p();u(),d("nzStatus",i.getTimeBadgeStatus(e.timeRemainingMs))("nzText",i.formatTimeRemaining(e.timeRemainingMs)),u(3),k(j(5,3,e.dueAt,"MMM d, h:mm a"))}}function rn(n,t){if(n&1&&(s(0,"div")(1,"span"),m(2),T(3,"date"),l()()),n&2){let e=p().$implicit;u(2),k(j(3,1,e.updatedAt,"MMM d, y h:mm a"))}}function on(n,t){n&1&&(s(0,"span"),m(1,"Start Review"),l())}function an(n,t){n&1&&(s(0,"span"),m(1,"Continue"),l())}function sn(n,t){n&1&&(s(0,"span"),m(1,"View"),l())}function ln(n,t){n&1&&(s(0,"span"),m(1,"Expired"),l())}function cn(n,t){if(n&1){let e=S();s(0,"tr")(1,"td")(2,"a",23),m(3),l()(),s(4,"td"),m(5),l(),s(6,"td"),m(7),l(),s(8,"td"),g(9,Xt,3,4,"span",24)(10,Zt,2,0,"span",24),l(),s(11,"td")(12,"nz-tag",25),m(13),l(),g(14,Qt,1,0,"nz-badge",26),l(),s(15,"td"),g(16,Jt,2,2,"nz-tag",27)(17,Yt,2,0,"span",24),l(),s(18,"td"),g(19,en,1,2,"nz-rate",28)(20,tn,2,0,"span",24),l(),s(21,"td"),g(22,nn,6,6,"div",24)(23,rn,4,4,"div",24),l(),s(24,"td"),m(25),l(),s(26,"td")(27,"button",29),C("click",function(){let r=w(e).$implicit,o=p();return _(o.openReviewForm(r))}),g(28,on,2,0,"span",24)(29,an,2,0,"span",24)(30,sn,2,0,"span",24)(31,ln,2,0,"span",24),l()()()}if(n&2){let e=t.$implicit,i=p();u(2),d("routerLink",D(22,Pt))("queryParams",F(23,$t,e.workOrderId)),u(),V(" ",(e.workOrder==null?null:e.workOrder.number)||"-"," "),u(2),k((e.workOrder==null||e.workOrder.customer==null?null:e.workOrder.customer.name)||"-"),u(2),k(e.technicianName),u(2),d("ngIf",e.workOrder==null?null:e.workOrder.completedAt),u(),d("ngIf",!(e.workOrder!=null&&e.workOrder.completedAt)),u(2),d("nzColor",i.statusColors[e.status]),u(),V(" ",i.statusLabels[e.status]," "),u(),d("ngIf",e.isOverdue),u(2),d("ngIf",e.reviewOutcome),u(),d("ngIf",!e.reviewOutcome),u(2),d("ngIf",e.reviewScore!==void 0),u(),d("ngIf",e.reviewScore===void 0),u(2),d("ngIf",e.status==="PENDING"||e.status==="IN_REVIEW"),u(),d("ngIf",e.status==="COMPLETED"),u(2),k(e.supervisorName),u(2),d("disabled",e.status==="COMPLETED"||e.status==="EXPIRED"),u(),d("ngIf",e.status==="PENDING"),u(),d("ngIf",e.status==="IN_REVIEW"),u(),d("ngIf",e.status==="COMPLETED"),u(),d("ngIf",e.status==="EXPIRED")}}function un(n,t){if(n&1&&(s(0,"p"),m(1),l()),n&2){let e=p(2);u(),V("Work Order: ",e.selectedTask.workOrderId)}}function dn(n,t){if(n&1&&(s(0,"div")(1,"p"),m(2,"Review form will be implemented here."),l(),g(3,un,2,1,"p",24),l()),n&2){let e=p();u(3),d("ngIf",e.selectedTask)}}var Tt=class n{reviewTaskService=h(K);reviewService=h(Z);stateService=h(G);selectedStatus="ALL";selectedOutcome=null;dateRange=null;tableData$=this.buildTableData();pendingCount$=this.reviewTaskService.pendingTasks$.pipe(z(t=>t.length));overdueCount$=this.reviewTaskService.overdueTasks$.pipe(z(t=>t.length));inReviewCount$=this.reviewTaskService.inReviewTasks$.pipe(z(t=>t.length));drawerVisible=!1;selectedTask=null;statusLabels=xt;statusColors=Ot;outcomeLabels=St;outcomeColors=bt;statusOptions=[{label:"All",value:"ALL"},{label:"Pending",value:"PENDING"},{label:"In Review",value:"IN_REVIEW"},{label:"Overdue",value:"OVERDUE"},{label:"Completed",value:"COMPLETED"},{label:"Expired",value:"EXPIRED"}];buildTableData(){return this.reviewTaskService.tasks$.pipe(z(t=>{let e=new Date().getTime();return t.map(i=>{let r=this.stateService.getWorkOrder(i.workOrderId),o=this.reviewTaskService.isOverdue(i),v=this.reviewTaskService.getTimeRemaining(i);return y(b({},i),{workOrder:r,technicianName:r?.assignedTechnicianId?`Tech ${r.assignedTechnicianId.slice(-4)}`:"-",supervisorName:i.supervisorId?`Supervisor ${i.supervisorId.slice(-4)}`:"Unassigned",reviewOutcome:r?.supervisorReviewOutcome||void 0,reviewScore:void 0,isOverdue:o,timeRemainingMs:v})})}),z(t=>this.applyFilters(t)))}applyFilters(t){let e=[...t];if(this.selectedStatus==="OVERDUE"?e=e.filter(i=>i.isOverdue):this.selectedStatus!=="ALL"&&(e=e.filter(i=>i.status===this.selectedStatus)),this.selectedOutcome&&(e=e.filter(i=>i.reviewOutcome===this.selectedOutcome)),this.dateRange&&this.dateRange.length===2){let[i,r]=this.dateRange;e=e.filter(o=>{if(!o.workOrder?.completedAt)return!1;let v=new Date(o.workOrder.completedAt);return v>=i&&v<=r})}return e}onStatusFilterChange(){this.tableData$=this.buildTableData()}onOutcomeFilterChange(){this.tableData$=this.buildTableData()}onDateRangeChange(){this.tableData$=this.buildTableData()}clearFilters(){this.selectedStatus="ALL",this.selectedOutcome=null,this.dateRange=null,this.tableData$=this.buildTableData()}openReviewForm(t){this.selectedTask=t,this.drawerVisible=!0}closeReviewForm(){this.drawerVisible=!1,this.selectedTask=null}onReviewSubmitted(){this.closeReviewForm(),this.tableData$=this.buildTableData()}formatTimeRemaining(t){if(t===void 0||t<0)return"Overdue";let e=Math.floor(t/(1e3*60*60)),i=Math.floor(t%(1e3*60*60)/(1e3*60));return e>24?`${Math.floor(e/24)}d ${e%24}h`:`${e}h ${i}m`}getTimeBadgeStatus(t){if(t===void 0||t<0)return"error";let e=t/(1e3*60*60);return e<2?"error":e<6?"warning":"processing"}getOutcomeColor(t){return t&&this.outcomeColors[t]||"default"}getOutcomeLabel(t){return t?this.outcomeLabels[t]||t:"-"}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=M({type:n,selectors:[["app-reviews"]],decls:43,vars:12,consts:[["reviewTable",""],[1,"reviews-container"],[1,"reviews-header"],[3,"nzSize"],[4,"nzSpaceItem"],[1,"filters-card"],[1,"reviews-table",3,"nzData","nzPageSize","nzShowPagination","nzLoading"],[4,"ngFor","ngForOf"],["nzTitle","Supervisor Review",3,"nzOnClose","nzVisible","nzWidth"],[4,"nzDrawerContent"],["nzTitle","Pending Reviews",3,"nzValue","nzValueStyle"],["nzTitle","Overdue",3,"nzValue","nzValueStyle"],["nzTitle","In Review",3,"nzValue","nzValueStyle"],[2,"width","150px",3,"ngModelChange","ngModel"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel"],["nzAllowClear","","nzPlaceHolder","Select outcome",2,"width","180px",3,"ngModelChange","ngModel"],["nzValue","Approved","nzLabel","Approved"],["nzValue","NeedsRework","nzLabel","Needs Rework"],["nzValue","FollowUpRequired","nzLabel","Follow-Up Required"],["nzValue","Rejected","nzLabel","Rejected"],[3,"ngModelChange","ngModel"],["nz-button","","nzType","default",3,"click"],[3,"routerLink","queryParams"],[4,"ngIf"],[3,"nzColor"],["nzStatus","error","nzText","Overdue","style","margin-left: 8px",4,"ngIf"],[3,"nzColor",4,"ngIf"],["nzDisabled","",3,"ngModel","nzAllowHalf",4,"ngIf"],["nz-button","","nzType","primary","nzSize","small",3,"click","disabled"],["nzStatus","error","nzText","Overdue",2,"margin-left","8px"],["nzDisabled","",3,"ngModel","nzAllowHalf"],[3,"nzStatus","nzText"],[1,"text-muted"]],template:function(e,i){if(e&1){let r=S();s(0,"div",1)(1,"div",2)(2,"h2"),m(3,"Supervisor Reviews"),l(),s(4,"nz-space",3),g(5,Ht,3,5,"ng-container",4)(6,Wt,3,5,"ng-container",4)(7,Bt,3,5,"ng-container",4),l()(),s(8,"nz-card",5)(9,"nz-space",3),g(10,jt,5,2,"ng-container",4)(11,qt,8,1,"ng-container",4)(12,Kt,4,1,"ng-container",4)(13,Gt,3,0,"ng-container",4),l()(),s(14,"nz-table",6,0),T(16,"async"),s(17,"thead")(18,"tr")(19,"th"),m(20,"WO Number"),l(),s(21,"th"),m(22,"Customer"),l(),s(23,"th"),m(24,"Technician"),l(),s(25,"th"),m(26,"Completed At"),l(),s(27,"th"),m(28,"Review Status"),l(),s(29,"th"),m(30,"Outcome"),l(),s(31,"th"),m(32,"Score"),l(),s(33,"th"),m(34,"Due / Reviewed At"),l(),s(35,"th"),m(36,"Supervisor"),l(),s(37,"th"),m(38,"Actions"),l()()(),s(39,"tbody"),g(40,cn,32,25,"tr",7),l()()(),s(41,"nz-drawer",8),C("nzOnClose",function(){return w(r),_(i.closeReviewForm())}),g(42,dn,4,1,"div",9),l()}if(e&2){let r=H(15);u(4),d("nzSize",16),u(5),d("nzSize",12),u(5),d("nzData",L(16,9,i.tableData$)||D(11,Nt))("nzPageSize",20)("nzShowPagination",!0)("nzLoading",!1),u(26),d("ngForOf",r.data),u(),d("nzVisible",i.drawerVisible)("nzWidth",600)}},dependencies:[Ee,Se,be,Ie,ye,We,$e,He,ot,nt,Ye,et,rt,tt,it,Xe,Ge,qe,Ke,st,at,vt,pt,Je,Ze,Qe,_t,ft,wt,ut,ct,lt,Rt,te,Le,Fe,je,Ue,Be,Me,Ne,Oe,Te],styles:[".reviews-container[_ngcontent-%COMP%]{padding:24px}.reviews-header[_ngcontent-%COMP%]{margin-bottom:24px;display:flex;justify-content:space-between;align-items:center}.reviews-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:600}.filters-card[_ngcontent-%COMP%]{margin-bottom:16px}.reviews-table[_ngcontent-%COMP%]{background:#fff;border-radius:8px}.text-muted[_ngcontent-%COMP%]{color:#8c8c8c;font-size:12px}"]})};export{Tt as ReviewsComponent};
