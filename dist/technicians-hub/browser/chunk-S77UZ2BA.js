import{a as ae,b as le,c as me}from"./chunk-32YKJWL6.js";import{a as ce,b as se}from"./chunk-XSZPG6JQ.js";import{a as Le,b as xe}from"./chunk-Y3GYSLY6.js";import{a as _e,b as Ce}from"./chunk-XIN4KULS.js";import{b as ge,c as Se,d as Ie}from"./chunk-7KHN4GSN.js";import"./chunk-53AZ54VS.js";import{a as de,b as pe,c as ue,d as ze,e as ve,n as fe}from"./chunk-FDJQSJ4V.js";import{d as ye}from"./chunk-WESEQCCP.js";import"./chunk-JHEXQXAK.js";import{b as he,e as be}from"./chunk-7YQTHMTJ.js";import{c as Q,d as X,e as Z,f as ee,g as te,h as ne,i as ie}from"./chunk-H2G74B6L.js";import"./chunk-CESBHL5B.js";import"./chunk-GC2JCOQQ.js";import{a as oe,b as re}from"./chunk-2QDM327Y.js";import{a as F,b as D}from"./chunk-H5EFK6NK.js";import{g as H,j as $,k as U,o as Y,p as K,q as J}from"./chunk-Y4SKA4DN.js";import"./chunk-LF3AIU6I.js";import"./chunk-OX3V4ML4.js";import"./chunk-5AAZBCL7.js";import"./chunk-6RCJUTWS.js";import{e as S,g as k,h as B,k as A,m as P,n as R,p as q,q as G,r as W}from"./chunk-YLQVLZ7P.js";import"./chunk-CN3ZPC5G.js";import"./chunk-4VDSMCYZ.js";import{Ia as O,j as V,k as j,p as M}from"./chunk-7ENSWGND.js";import{Ac as T,Bc as E,Cc as w,Sb as c,Tb as n,Ub as t,Vb as _,Zb as y,_b as h,ac as b,bb as l,fc as C,hc as s,la as z,lb as f,ma as v,rb as x,rc as L,tc as N,wc as o,xb as p,xc as u,yc as g}from"./chunk-WBOJ7OJP.js";function Te(a,i){if(a&1){let e=b();n(0,"tr")(1,"td"),o(2),t(),n(3,"td")(4,"nz-tag",10),o(5),t()(),n(6,"td"),o(7),t(),n(8,"td"),o(9),t(),n(10,"td")(11,"button",11),C("click",function(){let m=z(e).$implicit,d=s();return v(d.openDrawer(m))}),o(12,"View Stock"),t(),n(13,"button",11),C("click",function(){let m=z(e).$implicit,d=s();return v(d.showAdjustModal(m))}),o(14,"Adjust"),t()()()}if(a&2){let e=i.$implicit,r=s();l(2),u(e.name),l(2),c("nzColor",r.getTypeColor(e.type)),l(),u(r.getTypeLabel(e.type)),l(2),u(e.technicianId||"-"),l(2),g("",r.getItemCount(e.id)," items")}}function Ee(a,i){if(a&1&&(n(0,"p")(1,"strong"),o(2,"Technician:"),t(),o(3),t()),a&2){let e=s(3);l(3),g(" ",e.selectedLocation.technicianId)}}function we(a,i){if(a&1&&(n(0,"p")(1,"strong"),o(2,"Address:"),t(),o(3),t()),a&2){let e=s(3);l(3),g(" ",e.selectedLocation.address)}}function Ve(a,i){if(a&1&&(n(0,"tr")(1,"td"),o(2),t(),n(3,"td"),o(4),t(),n(5,"td"),o(6),t(),n(7,"td"),o(8),t()()),a&2){let e=i.$implicit,r=s(3);l(2),u(r.getItemName(e.itemId)),l(2),u(e.onHand),l(2),u(e.reserved),l(),N("low-stock",r.isLowStock(e)),l(),u(e.available)}}function je(a,i){if(a&1&&(n(0,"div")(1,"p")(2,"strong"),o(3,"Type:"),t(),o(4),t(),p(5,Ee,4,1,"p",12)(6,we,4,1,"p",12),_(7,"nz-divider",13),n(8,"nz-table",14,1)(10,"thead")(11,"tr")(12,"th"),o(13,"Item"),t(),n(14,"th"),o(15,"On Hand"),t(),n(16,"th"),o(17,"Reserved"),t(),n(18,"th"),o(19,"Available"),t()()(),n(20,"tbody"),p(21,Ve,9,6,"tr",5),t()()()),a&2){let e=L(9),r=s(2);l(4),g(" ",r.getTypeLabel(r.selectedLocation.type)),l(),c("ngIf",r.selectedLocation.technicianId),l(),c("ngIf",r.selectedLocation.address),l(2),c("nzData",r.locationBalances)("nzPageSize",10),l(13),c("ngForOf",e.data)}}function Me(a,i){if(a&1&&(y(0),p(1,je,22,6,"div",12),h()),a&2){let e=s();l(),c("ngIf",e.selectedLocation)}}function Oe(a,i){if(a&1&&_(0,"nz-option",27),a&2){let e=i.$implicit;c("nzValue",e.id)("nzLabel",e.name+" ("+e.sku+")")}}function Fe(a,i){if(a&1&&(y(0),n(1,"form",15)(2,"nz-form-item")(3,"nz-form-label",16),o(4,"Item"),t(),n(5,"nz-form-control")(6,"nz-select",17),p(7,Oe,1,2,"nz-option",18),t()()(),n(8,"nz-form-item")(9,"nz-form-label",16),o(10,"Adjustment (+/-)"),t(),n(11,"nz-form-control",19),_(12,"nz-input-number",20),t()(),n(13,"nz-form-item")(14,"nz-form-label",16),o(15,"Reason"),t(),n(16,"nz-form-control")(17,"nz-select",21),_(18,"nz-option",22)(19,"nz-option",23)(20,"nz-option",24)(21,"nz-option",25)(22,"nz-option",26),t()()()(),h()),a&2){let e=s();l(),c("formGroup",e.adjustForm),l(6),c("ngForOf",e.allItems)}}var Ne=class a{constructor(i,e,r,m,d){this.locationService=i;this.inventoryService=e;this.itemService=r;this.fb=m;this.message=d;this.adjustForm=this.fb.group({itemId:["",S.required],qty:[0,S.required],reason:["Cycle Count",S.required]})}locations=[];allItems=[];drawerVisible=!1;selectedLocation=null;locationBalances=[];adjustModalVisible=!1;adjustLocationId="";adjustForm;ngOnInit(){this.locations=this.locationService.getAll(),this.allItems=this.itemService.getAll()}getTypeColor(i){return{WAREHOUSE:"blue",TRUCK:"green",SITE:"purple"}[i]||"default"}getTypeLabel(i){return he[i]||i}getItemCount(i){return this.inventoryService.getBalancesForLocation(i).length}getItemName(i){return this.itemService.getById(i)?.name||i}isLowStock(i){let e=this.itemService.getById(i.itemId);return!!e?.reorderPoint&&i.available<=e.reorderPoint}openDrawer(i){this.selectedLocation=i,this.locationBalances=this.inventoryService.getBalancesForLocation(i.id),this.drawerVisible=!0}closeDrawer(){this.drawerVisible=!1,this.selectedLocation=null}showAdjustModal(i){this.adjustLocationId=i.id,this.adjustForm.reset({qty:0,reason:"Cycle Count"}),this.adjustModalVisible=!0}saveAdjustment(){if(this.adjustForm.invalid){Object.values(this.adjustForm.controls).forEach(m=>m.markAsDirty());return}let{itemId:i,qty:e,reason:r}=this.adjustForm.value;this.inventoryService.adjustStock(this.adjustLocationId,i,e,r),this.message.success("Stock adjusted"),this.adjustModalVisible=!1,this.selectedLocation?.id===this.adjustLocationId&&(this.locationBalances=this.inventoryService.getBalancesForLocation(this.adjustLocationId))}static \u0275fac=function(e){return new(e||a)(f(Le),f(xe),f(be),f(q),f(ye))};static \u0275cmp=x({type:a,selectors:[["app-inventory-locations"]],decls:24,vars:8,consts:[["locationsTable",""],["balanceTable",""],[1,"locations-page"],[1,"page-header"],[3,"nzData","nzPageSize"],[4,"ngFor","ngForOf"],["nzPlacement","right",3,"nzOnClose","nzClosable","nzVisible","nzTitle","nzWidth"],[4,"nzDrawerContent"],["nzTitle","Adjust Stock","nzOkText","Save",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible"],[4,"nzModalContent"],[3,"nzColor"],["nz-button","","nzType","link","nzSize","small",3,"click"],[4,"ngIf"],["nzText","Stock Balances"],["nzSize","small",3,"nzData","nzPageSize"],["nz-form","","nzLayout","vertical",3,"formGroup"],["nzRequired",""],["formControlName","itemId","nzShowSearch","","nzPlaceHolder","Select item",2,"width","100%"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nzErrorTip","Enter adjustment qty"],["formControlName","qty",2,"width","100%"],["formControlName","reason",2,"width","100%"],["nzValue","Cycle Count","nzLabel","Cycle Count"],["nzValue","Damage","nzLabel","Damage"],["nzValue","Receiving","nzLabel","Receiving"],["nzValue","Correction","nzLabel","Correction"],["nzValue","Other","nzLabel","Other"],[3,"nzValue","nzLabel"]],template:function(e,r){if(e&1){let m=b();n(0,"div",2)(1,"div",3)(2,"h2"),o(3,"Stock Locations"),t()(),n(4,"nz-table",4,0)(6,"thead")(7,"tr")(8,"th"),o(9,"Name"),t(),n(10,"th"),o(11,"Type"),t(),n(12,"th"),o(13,"Technician"),t(),n(14,"th"),o(15,"Items"),t(),n(16,"th"),o(17,"Actions"),t()()(),n(18,"tbody"),p(19,Te,15,5,"tr",5),t()(),n(20,"nz-drawer",6),C("nzOnClose",function(){return z(m),v(r.closeDrawer())}),p(21,Me,2,1,"ng-container",7),t(),n(22,"nz-modal",8),w("nzVisibleChange",function(I){return z(m),E(r.adjustModalVisible,I)||(r.adjustModalVisible=I),v(I)}),C("nzOnCancel",function(){return z(m),v(r.adjustModalVisible=!1)})("nzOnOk",function(){return z(m),v(r.saveAdjustment())}),p(23,Fe,23,2,"ng-container",9),t()()}if(e&2){let m=L(5);l(4),c("nzData",r.locations)("nzPageSize",10),l(15),c("ngForOf",m.data),l(),c("nzClosable",!0)("nzVisible",r.drawerVisible)("nzTitle",(r.selectedLocation==null?null:r.selectedLocation.name)||"Location")("nzWidth",520),l(2),T("nzVisible",r.adjustModalVisible)}},dependencies:[M,V,j,G,A,k,B,W,R,P,ie,ee,Q,X,ne,Z,te,U,$,H,O,re,oe,me,le,ae,Ie,Se,ge,ve,D,F,pe,de,ze,ue,fe,Ce,_e,J,Y,K,se,ce],styles:[".locations-page[_ngcontent-%COMP%]{padding:0}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.low-stock[_ngcontent-%COMP%]{color:#ff4d4f;font-weight:700}"]})};export{Ne as InventoryLocationsComponent};
