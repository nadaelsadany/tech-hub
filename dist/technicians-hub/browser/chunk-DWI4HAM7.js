import{a as I,b as S}from"./chunk-Y3GYSLY6.js";import{a as f,aa as c,b as d,ea as o,i as u}from"./chunk-WBOJ7OJP.js";var T=class a{constructor(e,t){this.inventoryService=e;this.locationService=t;this.initSeedData()}transfersSubject=new u([]);transfers$=this.transfersSubject.asObservable();initSeedData(){let e=new Date().toISOString(),t=[{id:"TRF-001",fromLocationId:"LOC-WH-001",toLocationId:"LOC-TRUCK-001",status:"PICKING",lines:[{itemId:"ITEM-003",qty:1},{itemId:"ITEM-007",qty:5}],createdAt:e,updatedAt:e}];this.transfersSubject.next(t)}generateId(){return"TRF-"+Math.random().toString(36).substr(2,6).toUpperCase()}getAll(){return this.transfersSubject.value}getById(e){return this.transfersSubject.value.find(t=>t.id===e)}getByStatus(e){return this.transfersSubject.value.filter(t=>t.status===e)}getOpenTransfers(){return this.transfersSubject.value.filter(e=>!["RECEIVED","CANCELLED"].includes(e.status))}create(e,t,r,n){let s=new Date().toISOString(),i={id:this.generateId(),fromLocationId:e,toLocationId:t,status:"DRAFT",lines:r,relatedWorkOrderId:n,createdAt:s,updatedAt:s};return this.transfersSubject.next([...this.transfersSubject.value,i]),i}updateStatus(e,t){let r=this.transfersSubject.value,n=r.findIndex(s=>s.id===e);if(n!==-1)return r[n]=d(f({},r[n]),{status:t,updatedAt:new Date().toISOString()}),this.transfersSubject.next([...r]),r[n]}startPicking(e){return this.updateStatus(e,"PICKING")}ship(e){let t=this.getById(e);if(!(!t||t.status!=="PICKING"))return t.lines.forEach(r=>{this.inventoryService.postTransaction({type:"TRANSFER_OUT",itemId:r.itemId,qty:r.qty,fromLocationId:t.fromLocationId,toLocationId:t.toLocationId,reason:`Transfer ${e} shipped`})}),this.updateStatus(e,"SHIPPED")}receive(e){let t=this.getById(e);if(!(!t||t.status!=="SHIPPED"))return t.lines.forEach(r=>{this.inventoryService.postTransaction({type:"TRANSFER_IN",itemId:r.itemId,qty:r.qty,fromLocationId:t.fromLocationId,toLocationId:t.toLocationId,reason:`Transfer ${e} received`})}),this.updateStatus(e,"RECEIVED")}cancel(e){let t=this.getById(e);if(!(!t||["RECEIVED","CANCELLED"].includes(t.status)))return t.status==="SHIPPED"&&t.lines.forEach(r=>{this.inventoryService.postTransaction({type:"ADJUST",itemId:r.itemId,qty:r.qty,fromLocationId:t.fromLocationId,reason:`Transfer ${e} cancelled - reversing`})}),this.updateStatus(e,"CANCELLED")}addLine(e,t,r){let n=this.transfersSubject.value,s=n.findIndex(i=>i.id===e);if(!(s===-1||n[s].status!=="DRAFT"))return n[s].lines.push({itemId:t,qty:r}),n[s].updatedAt=new Date().toISOString(),this.transfersSubject.next([...n]),n[s]}static \u0275fac=function(t){return new(t||a)(o(S),o(I))};static \u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"})};export{T as a};
