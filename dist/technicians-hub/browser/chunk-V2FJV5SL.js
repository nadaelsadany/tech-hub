import{a as it,b as rt,c as ot}from"./chunk-PNRDOIBH.js";import{a as vt}from"./chunk-XMT5HPYK.js";import"./chunk-LAGV6VRJ.js";import{b as Ke}from"./chunk-UM6B7XYO.js";import"./chunk-NAJWCQTC.js";import{a as ht,b as xt}from"./chunk-IG52HGJK.js";import{a as Je,b as Ze,c as Xe}from"./chunk-32YKJWL6.js";import{a as tt,b as nt}from"./chunk-XSZPG6JQ.js";import{a as ut,b as _t}from"./chunk-XIN4KULS.js";import{a as gt,b as ft,c as zt,d as Ct}from"./chunk-7KHN4GSN.js";import"./chunk-53AZ54VS.js";import{a as at,b as lt,c as st,d as mt,e as ct,k as dt,n as pt}from"./chunk-FDJQSJ4V.js";import{d as Ot}from"./chunk-WESEQCCP.js";import{b as et}from"./chunk-JHEXQXAK.js";import{c as $e,d as Be,e as je,f as Ue,g as qe,h as Ge,i as Qe}from"./chunk-H2G74B6L.js";import"./chunk-CESBHL5B.js";import"./chunk-GC2JCOQQ.js";import{a as He,b as Ye}from"./chunk-2QDM327Y.js";import{a as xe,b as ve}from"./chunk-H5EFK6NK.js";import{g as Re,h as ke,j as De,k as Ve,o as Ae,p as Le,q as We}from"./chunk-Y4SKA4DN.js";import{a as Fe,c as Pe}from"./chunk-LF3AIU6I.js";import"./chunk-OX3V4ML4.js";import"./chunk-5AAZBCL7.js";import{e as ze}from"./chunk-6RCJUTWS.js";import{d as Oe,e as Q,g as ye,h as be,j as Te,k as Se,m as Ne,n as Ie,p as Ee,q as we,r as Me}from"./chunk-YLQVLZ7P.js";import"./chunk-CN3ZPC5G.js";import"./chunk-4VDSMCYZ.js";import{Ha as he,Ia as V,j as pe,k as ue,l as _e,m as ge,p as fe,w as Ce,y as D,ya as q,za as G}from"./chunk-7ENSWGND.js";import{$b as A,Ac as w,Bc as M,Cc as R,Da as P,Kc as se,Lb as N,Lc as j,Nb as I,Pb as ne,Pc as me,Qb as ie,Qc as ce,Rb as re,Sb as m,Sc as b,Tb as r,Ub as i,Vb as _,Zb as v,_b as O,aa as Z,ac as h,ba as X,bb as o,dd as U,fa as y,fc as C,gd as de,hc as c,ic as L,j as J,jc as W,kc as oe,la as g,lb as S,lc as ae,ma as f,mc as $,nc as B,qa as ee,rb as E,rc as x,sb as te,sc as le,tc as k,wc as l,xb as p,xc as u,yc as z}from"./chunk-WBOJ7OJP.js";var wt=["template"],bt=["*"];function Mt(t,n){if(t&1&&(v(0),l(1),O()),t&2){let e=c(3);o(),u(e.nzLabel)}}function Rt(t,n){if(t&1&&(r(0,"div",2),p(1,Mt,2,1,"ng-container",5),i()),t&2){let e=c(2);o(),m("nzStringTemplateOutlet",e.nzLabel)}}function kt(t,n){if(t&1&&(v(0),l(1),O()),t&2){let e=c(2);o(),u(e.nzDot)}}function Dt(t,n){if(t&1&&(r(0,"li",1),N(1,Rt,2,1,"div",2),_(2,"div",3),r(3,"div",4),p(4,kt,2,1,"ng-container",5),i(),r(5,"div",6),W(6),i()()),t&2){let e=c();k("ant-timeline-item-right",(e.nzPosition||e.position)==="right")("ant-timeline-item-left",(e.nzPosition||e.position)==="left")("ant-timeline-item-last",e.isLast),o(),I(e.nzLabel?1:-1),o(2),le("border-color",e.borderColor),k("ant-timeline-item-head-red",e.nzColor==="red")("ant-timeline-item-head-blue",e.nzColor==="blue")("ant-timeline-item-head-green",e.nzColor==="green")("ant-timeline-item-head-gray",e.nzColor==="gray")("ant-timeline-item-head-custom",!!e.nzDot),o(),m("nzStringTemplateOutlet",e.nzDot)}}function Vt(t,n){if(t&1&&A(0,2),t&2){c();let e=x(6);m("ngTemplateOutlet",e)}}function Ft(t,n){}function Pt(t,n){if(t&1&&p(0,Ft,0,0,"ng-template",2),t&2){let e=n.$implicit;m("ngTemplateOutlet",e.template)}}function At(t,n){if(t&1&&A(0,2),t&2){c();let e=x(6);m("ngTemplateOutlet",e)}}function Lt(t,n){t&1&&_(0,"nz-icon",8)}function Wt(t,n){if(t&1&&(v(0),l(1),N(2,Lt,1,0,"nz-icon",8),O()),t&2){let e=c(3);o(),z(" ",e.nzPendingDot," "),o(),I(e.nzPendingDot?-1:2)}}function $t(t,n){if(t&1&&(v(0),l(1),O()),t&2){let e=c(3);o(),z(" ",e.isPendingBoolean?"":e.nzPending," ")}}function Bt(t,n){if(t&1&&(r(0,"li",3),_(1,"div",4),r(2,"div",5),p(3,Wt,3,2,"ng-container",6),i(),r(4,"div",7),p(5,$t,2,1,"ng-container",6),i()()),t&2){let e=c(2);o(3),m("nzStringTemplateOutlet",e.nzPendingDot),o(2),m("nzStringTemplateOutlet",e.nzPending)}}function jt(t,n){if(t&1&&N(0,Bt,6,2,"li",3),t&2){let e=c();I(e.nzPending?0:-1)}}var H=(()=>{class t{check$=new J(1);markForCheck(){this.check$.next()}static \u0275fac=function(s){return new(s||t)};static \u0275prov=Z({token:t,factory:t.\u0275fac})}return t})(),Ut=["red","blue","green","grey","gray"];function qt(t){return Ut.findIndex(n=>n===t)!==-1}var F=(()=>{class t{cdr=y(U);timelineService=y(H);template;nzPosition;nzColor="blue";nzDot;nzLabel;isLast=!1;borderColor=null;position;ngOnChanges(e){this.timelineService.markForCheck();let{nzColor:s}=e;s&&this.updateCustomColor()}detectChanges(){this.cdr.detectChanges()}updateCustomColor(){this.borderColor=qt(this.nzColor)?null:this.nzColor}static \u0275fac=function(s){return new(s||t)};static \u0275cmp=E({type:t,selectors:[["nz-timeline-item"],["","nz-timeline-item",""]],viewQuery:function(s,a){if(s&1&&ae(wt,5),s&2){let d;$(d=B())&&(a.template=d.first)}},inputs:{nzPosition:"nzPosition",nzColor:"nzColor",nzDot:"nzDot",nzLabel:"nzLabel"},exportAs:["nzTimelineItem"],features:[P],ngContentSelectors:bt,decls:2,vars:0,consts:[["template",""],[1,"ant-timeline-item"],[1,"ant-timeline-item-label"],[1,"ant-timeline-item-tail"],[1,"ant-timeline-item-head"],[4,"nzStringTemplateOutlet"],[1,"ant-timeline-item-content"]],template:function(s,a){s&1&&(L(),p(0,Dt,7,20,"ng-template",null,0,b))},dependencies:[G,q],encapsulation:2,changeDetection:0})}return t})(),Y=(()=>{class t{cdr=y(U);timelineService=y(H);directionality=y(Ce);destroyRef=y(ee);listOfItems;nzMode="left";nzPending;nzPendingDot;nzReverse=!1;isPendingBoolean=!1;timelineItems=[];dir="ltr";hasLabelItem=!1;ngOnChanges(e){let{nzMode:s,nzReverse:a,nzPending:d}=e;(yt(s)||yt(a))&&this.updateChildren(),d&&(this.isPendingBoolean=d.currentValue===!0)}ngOnInit(){this.timelineService.check$.pipe(D(this.destroyRef)).subscribe(()=>{this.cdr.markForCheck()}),this.directionality.change?.pipe(D(this.destroyRef)).subscribe(e=>{this.dir=e,this.cdr.detectChanges()}),this.dir=this.directionality.value}ngAfterContentInit(){this.updateChildren(),this.listOfItems.changes.pipe(D(this.destroyRef)).subscribe(()=>{this.updateChildren()})}updateChildren(){if(this.listOfItems&&this.listOfItems.length){let e=this.listOfItems.length,s=!1;this.listOfItems.forEach((a,d)=>{a.isLast=this.nzReverse?d===0:d===e-1,a.position=Gt(d,this.nzMode),!s&&a.nzLabel&&(s=!0),a.detectChanges()}),this.timelineItems=this.nzReverse?this.listOfItems.toArray().reverse():this.listOfItems.toArray(),this.hasLabelItem=s}else this.timelineItems=[],this.hasLabelItem=!1;this.cdr.markForCheck()}static \u0275fac=function(s){return new(s||t)};static \u0275cmp=E({type:t,selectors:[["nz-timeline"]],contentQueries:function(s,a,d){if(s&1&&oe(d,F,4),s&2){let T;$(T=B())&&(a.listOfItems=T)}},inputs:{nzMode:"nzMode",nzPending:"nzPending",nzPendingDot:"nzPendingDot",nzReverse:[2,"nzReverse","nzReverse",de]},exportAs:["nzTimeline"],features:[se([H]),P],ngContentSelectors:bt,decls:8,vars:14,consts:[["pendingTemplate",""],[1,"ant-timeline"],[3,"ngTemplateOutlet"],[1,"ant-timeline-item","ant-timeline-item-pending"],[1,"ant-timeline-item-tail"],[1,"ant-timeline-item-head","ant-timeline-item-head-custom","ant-timeline-item-head-blue"],[4,"nzStringTemplateOutlet"],[1,"ant-timeline-item-content"],["nzType","loading"]],template:function(s,a){s&1&&(L(),r(0,"ul",1),N(1,Vt,1,1,"ng-container",2),ie(2,Pt,1,1,null,2,ne),N(4,At,1,1,"ng-container",2),i(),p(5,jt,1,1,"ng-template",null,0,b),W(7)),s&2&&(k("ant-timeline-label",a.hasLabelItem)("ant-timeline-right",!a.hasLabelItem&&a.nzMode==="right")("ant-timeline-alternate",a.nzMode==="alternate"||a.nzMode==="custom")("ant-timeline-pending",!!a.nzPending)("ant-timeline-reverse",a.nzReverse)("ant-timeline-rtl",a.dir==="rtl"),o(),I(a.nzReverse?1:-1),o(),re(a.timelineItems),o(2),I(a.nzReverse?-1:4))},dependencies:[_e,G,q,V,he],encapsulation:2,changeDetection:0})}return t})();function yt(t){return!!(t&&(t.previousValue!==t.currentValue||t.isFirstChange()))}function Gt(t,n){if(n!=="custom")return n==="left"||n==="right"?n:n==="alternate"&&t%2===0?"left":"right"}var Tt=(()=>{class t{static \u0275fac=function(s){return new(s||t)};static \u0275mod=te({type:t});static \u0275inj=X({imports:[F,Y]})}return t})();var K={"Reschedule-CustomerRequest":"Reschedule - Customer Request","Reschedule-TechnicianDelay":"Reschedule - Technician Delay","Reschedule-PartsUnavailable":"Reschedule - Parts Unavailable","Reassign-Capacity":"Reassign - Capacity Issue","Reassign-SkillMismatch":"Reassign - Skill Mismatch","NoShow-Customer":"No-Show - Customer","Warranty-NotCovered":"Warranty - Not Covered",Other:"Other"},St={Fixed:"Fixed",TemporaryFix:"Temporary Fix",NotResolved:"Not Resolved",InspectionOnly:"Inspection Only",Cancelled:"Cancelled"};var It=()=>[];function Ht(t,n){t&1&&_(0,"nz-badge",21)}function Yt(t,n){t&1&&(r(0,"span",22),l(1,"-"),i())}function Kt(t,n){if(t&1){let e=h();r(0,"button",18),C("click",function(){g(e);let a=c().$implicit,d=c();return f(d.setReady(a))}),l(1,"Set Ready"),i()}}function Jt(t,n){if(t&1){let e=h();r(0,"button",18),C("click",function(){g(e);let a=c().$implicit,d=c();return f(d.autoAssign(a))}),l(1,"Auto Assign"),i()}}function Zt(t,n){if(t&1){let e=h();r(0,"button",23),C("click",function(){g(e);let a=c().$implicit,d=c();return f(d.cancelOrder(a))}),l(1,"Cancel"),i()}}function Xt(t,n){if(t&1){let e=h();r(0,"tr")(1,"td")(2,"a",14),C("click",function(){let a=g(e).$implicit,d=c();return f(d.openDrawer(a))}),l(3),i()(),r(4,"td"),l(5),i(),r(6,"td"),l(7),i(),r(8,"td")(9,"nz-tag",15),l(10),i()(),r(11,"td")(12,"nz-tag",15),l(13),i()(),r(14,"td"),l(15),i(),r(16,"td"),p(17,Ht,1,0,"nz-badge",16)(18,Yt,2,0,"span",17),i(),r(19,"td"),l(20),i(),r(21,"td")(22,"button",18),C("click",function(){let a=g(e).$implicit,d=c();return f(d.openDrawer(a))}),l(23,"Details"),i(),p(24,Kt,2,0,"button",19)(25,Jt,2,0,"button",19)(26,Zt,2,0,"button",20),i()()}if(t&2){let e=n.$implicit,s=c();o(3),u(e.number),o(2),u(e.customer.name),o(2),u(e.category),o(2),m("nzColor",s.getStatusColor(e.status)),o(),u(e.status),o(2),m("nzColor",s.getPriorityColor(e.priority)),o(),u(e.priority),o(2),u(s.getTechName(e.assignedTechnicianId)),o(2),m("ngIf",e.result),o(),m("ngIf",!e.result),o(2),u(s.getRelativeTime(e)),o(4),m("ngIf",e.status==="New"),o(),m("ngIf",e.status==="Ready"),o(),m("ngIf",s.canCancel(e))}}function en(t,n){t&1&&(r(0,"nz-tag",28),l(1,"Warranty"),i())}function tn(t,n){if(t&1&&(r(0,"div",25)(1,"span",26),l(2),i(),r(3,"nz-tag",15),l(4),i(),r(5,"nz-tag",15),l(6),i(),p(7,en,2,0,"nz-tag",27),i()),t&2){let e=c(2);o(2),u(e.selectedOrder.number),o(),m("nzColor",e.getStatusColor(e.selectedOrder.status)),o(),u(e.selectedOrder.status),o(),m("nzColor",e.getPriorityColor(e.selectedOrder.priority)),o(),u(e.selectedOrder.priority),o(),m("ngIf",e.selectedOrder.warranty)}}function nn(t,n){if(t&1&&p(0,tn,8,6,"div",24),t&2){let e=c();m("ngIf",e.selectedOrder)}}function rn(t,n){if(t&1&&(r(0,"p")(1,"strong"),l(2,"Unit:"),i(),l(3),i()),t&2){let e=c(3);o(3),z(" ",e.selectedOrder.customer.unit)}}function on(t,n){if(t&1&&(r(0,"p"),l(1),i()),t&2){let e=c(3);o(),u(e.selectedOrder.address.city)}}function an(t,n){if(t&1&&(r(0,"p")(1,"strong"),l(2,"Technician:"),i(),l(3),_(4,"br"),r(5,"strong"),l(6,"Scheduled:"),i(),l(7),_(8,"br"),r(9,"strong"),l(10,"ETA:"),i(),l(11),i()),t&2){let e=c(3);o(3),z(" ",e.getTechName(e.selectedOrder.assignedTechnicianId)),o(4),z(" ",e.formatDateTime(e.selectedOrder.scheduledStartAt)),o(4),z(" ",e.selectedOrder.etaMin||"-"," min ")}}function ln(t,n){t&1&&(r(0,"p"),l(1,"Not assigned yet."),i())}function sn(t,n){if(t&1){let e=h();r(0,"button",56),C("click",function(){g(e);let a=c(4);return f(a.showReassignModal())}),l(1,"Reassign"),i()}}function mn(t,n){if(t&1){let e=h();r(0,"button",52),C("click",function(){g(e);let a=c(4);return f(a.completeOrder())}),l(1,"Complete"),i()}}function cn(t,n){if(t&1&&(r(0,"div",53),p(1,sn,2,0,"button",54)(2,mn,2,0,"button",55),i()),t&2){let e=c(3);o(),m("ngIf",e.selectedOrder.assignedTechnicianId),o(),m("ngIf",e.selectedOrder.status==="OnSite")}}function dn(t,n){if(t&1&&(r(0,"div",63)(1,"nz-tag"),l(2),i()()),t&2){let e=c().$implicit,s=c(4);o(2),u(s.getReasonLabel(e.reason))}}function pn(t,n){if(t&1&&(r(0,"div",64),l(1),i()),t&2){let e=c().$implicit;o(),u(e.note)}}function un(t,n){if(t&1&&(r(0,"nz-timeline-item",15)(1,"div",58)(2,"strong"),l(3),i(),r(4,"span",59),l(5),i(),r(6,"div",60),l(7),i(),p(8,dn,3,1,"div",61)(9,pn,2,1,"div",62),i()()),t&2){let e=n.$implicit,s=c(4);m("nzColor",s.getTimelineColor(e.toStatus)),o(3),u(e.toStatus),o(2),z(" by ",e.by.name),o(2),u(s.formatDateTime(e.at)),o(),m("ngIf",e.reason),o(),m("ngIf",e.note)}}function _n(t,n){if(t&1&&(r(0,"nz-timeline"),p(1,un,10,6,"nz-timeline-item",57),i()),t&2){let e=c(3);o(),m("ngForOf",e.selectedOrder.statusHistory)}}function gn(t,n){t&1&&_(0,"nz-empty",65)}function fn(t,n){if(t&1&&(r(0,"tr")(1,"td"),l(2),i(),r(3,"td"),l(4),i(),r(5,"td"),l(6),i(),r(7,"td"),l(8),i(),r(9,"td"),l(10),i()()),t&2){let e=n.$implicit,s=c(4);o(2),u(s.formatFieldName(e.field)),o(2),u(e.from||"-"),o(2),u(e.to||"-"),o(2),u(e.by.name),o(2),u(s.formatDateTime(e.at))}}function zn(t,n){if(t&1&&(r(0,"nz-table",66,4)(2,"thead")(3,"tr")(4,"th"),l(5,"Field"),i(),r(6,"th"),l(7,"From"),i(),r(8,"th"),l(9,"To"),i(),r(10,"th"),l(11,"By"),i(),r(12,"th"),l(13,"When"),i()()(),r(14,"tbody"),p(15,fn,11,5,"tr",9),i()()),t&2){let e=x(1),s=c(3);m("nzData",s.selectedOrder.changeLog||j(3,It))("nzPageSize",5),o(15),m("ngForOf",e.data)}}function Cn(t,n){t&1&&_(0,"nz-empty",67)}function hn(t,n){if(t&1&&_(0,"nz-option",68),t&2){let e=n.$implicit;m("nzValue",e.value)("nzLabel",e.label)}}function xn(t,n){if(t&1){let e=h();r(0,"nz-tabs")(1,"nz-tab",30)(2,"div",31)(3,"h4"),l(4,"Customer"),i(),r(5,"p")(6,"strong"),l(7,"Name:"),i(),l(8),i(),r(9,"p")(10,"strong"),l(11,"Phone:"),i(),l(12),i(),r(13,"p")(14,"strong"),l(15,"Email:"),i(),l(16),i(),p(17,rn,4,1,"p",29),_(18,"nz-divider"),r(19,"h4"),l(20,"Address"),i(),r(21,"p"),l(22),i(),p(23,on,2,1,"p",29),_(24,"nz-divider"),r(25,"h4"),l(26,"Assignment"),i(),p(27,an,12,3,"p",29)(28,ln,2,0,"p",29)(29,cn,3,2,"div",32),i()(),r(30,"nz-tab",33)(31,"div",31),p(32,_n,2,1,"nz-timeline",34)(33,gn,1,0,"ng-template",null,2,b),i()(),r(35,"nz-tab",35)(36,"div",31),p(37,zn,16,4,"nz-table",36)(38,Cn,1,0,"ng-template",null,3,b),i()(),r(40,"nz-tab",37)(41,"div",31)(42,"form",38)(43,"nz-form-item")(44,"nz-form-label",39),l(45,"Resolution"),i(),r(46,"nz-form-control")(47,"nz-select",40),p(48,hn,1,2,"nz-option",41),i()()(),r(49,"nz-form-item")(50,"nz-form-label",39),l(51,"Summary"),i(),r(52,"nz-form-control",42),_(53,"textarea",43),i()(),r(54,"nz-form-item")(55,"nz-form-label"),l(56,"On-site Duration (min)"),i(),r(57,"nz-form-control"),_(58,"nz-input-number",44),i()(),r(59,"nz-form-item")(60,"nz-form-label"),l(61,"Technician Note"),i(),r(62,"nz-form-control"),_(63,"textarea",45),i()(),_(64,"nz-divider",46),r(65,"div",47)(66,"div",48)(67,"nz-form-item")(68,"nz-form-label"),l(69,"Warranty Covered"),i(),r(70,"nz-form-control"),_(71,"nz-input-number",49),i()()(),r(72,"div",48)(73,"nz-form-item")(74,"nz-form-label"),l(75,"Customer Charge"),i(),r(76,"nz-form-control"),_(77,"nz-input-number",50),i()()()(),r(78,"div",51)(79,"button",52),C("click",function(){g(e);let a=c(2);return f(a.saveResult())}),l(80,"Save Result"),i()()()()()()}if(t&2){let e=x(34),s=x(39),a=c(2);o(8),z(" ",a.selectedOrder.customer.name),o(4),z(" ",a.selectedOrder.customer.phone||"N/A"),o(4),z(" ",a.selectedOrder.customer.email||"N/A"),o(),m("ngIf",a.selectedOrder.customer.unit),o(5),u(a.selectedOrder.address.line1),o(),m("ngIf",a.selectedOrder.address.city),o(4),m("ngIf",a.selectedOrder.assignedTechnicianId),o(),m("ngIf",!a.selectedOrder.assignedTechnicianId),o(),m("ngIf",a.selectedOrder.status!=="Completed"&&a.selectedOrder.status!=="Cancelled"),o(3),m("ngIf",a.selectedOrder.statusHistory==null?null:a.selectedOrder.statusHistory.length)("ngIfElse",e),o(5),m("ngIf",a.selectedOrder.changeLog==null?null:a.selectedOrder.changeLog.length)("ngIfElse",s),o(5),m("formGroup",a.resultForm),o(6),m("ngForOf",a.resolutionOptions),o(10),m("nzMin",0)("nzMax",480),o(7),m("nzGutter",16),o(),m("nzSpan",12),o(5),m("nzMin",0),o(),m("nzSpan",12),o(5),m("nzMin",0)}}function vn(t,n){if(t&1&&(v(0),p(1,xn,81,22,"nz-tabs",29),O()),t&2){let e=c();o(),m("ngIf",e.selectedOrder)}}function On(t,n){if(t&1&&_(0,"nz-option",68),t&2){let e=n.$implicit;m("nzValue",e.id)("nzLabel",e.name)}}function yn(t,n){if(t&1&&_(0,"nz-option",68),t&2){let e=n.$implicit;m("nzValue",e.value)("nzLabel",e.label)}}function bn(t,n){if(t&1){let e=h();v(0),r(1,"nz-form-item")(2,"nz-form-label"),l(3,"Select Technician"),i(),r(4,"nz-form-control")(5,"nz-select",69),R("ngModelChange",function(a){g(e);let d=c();return M(d.reassignTechId,a)||(d.reassignTechId=a),f(a)}),p(6,On,1,2,"nz-option",41),i()()(),r(7,"nz-form-item")(8,"nz-form-label"),l(9,"Reason"),i(),r(10,"nz-form-control")(11,"nz-select",69),R("ngModelChange",function(a){g(e);let d=c();return M(d.reassignReason,a)||(d.reassignReason=a),f(a)}),p(12,yn,1,2,"nz-option",41),i()()(),r(13,"nz-form-item")(14,"nz-form-label"),l(15,"Note (optional)"),i(),r(16,"nz-form-control")(17,"textarea",70),R("ngModelChange",function(a){g(e);let d=c();return M(d.reassignNote,a)||(d.reassignNote=a),f(a)}),i()()(),O()}if(t&2){let e=c();o(5),w("ngModel",e.reassignTechId),o(),m("ngForOf",e.availableTechs),o(5),w("ngModel",e.reassignReason),o(),m("ngForOf",e.reasonOptions),o(5),w("ngModel",e.reassignNote)}}var Nt=class t{constructor(n,e,s,a,d){this.stateService=n;this.autoAssignService=e;this.message=s;this.modal=a;this.fb=d;this.workOrders$=this.stateService.workOrders$,this.resultForm=this.fb.group({resolutionCode:["Fixed",Q.required],summary:["",Q.required],durationMin:[null],technicianNote:[""],warrantyCovered:[null],customerCharge:[null]})}workOrders$;drawerVisible=!1;selectedOrder=null;resultForm;resolutionOptions=Object.entries(St).map(([n,e])=>({value:n,label:e}));reassignModalVisible=!1;reassignTechId=null;reassignReason="Reassign-Capacity";reassignNote="";availableTechs=[];reasonOptions=Object.entries(K).map(([n,e])=>({value:n,label:e}));ngOnInit(){this.availableTechs=this.stateService.getTechnicians().filter(n=>n.active).map(n=>({id:n.id,name:n.name}))}getStatusColor(n){return{New:"default",Ready:"gold",Assigned:"geekblue",EnRoute:"cyan",OnSite:"processing",Completed:"green",OnHold:"volcano",Cancelled:"red"}[n]||"default"}getPriorityColor(n){return{Low:"success",Normal:"processing",High:"warning",Urgent:"error"}[n]||"default"}getTechName(n){if(!n)return"-";let e=this.stateService.getTechnician(n);return e?e.name:n}getRelativeTime(n){let e=this.stateService.getLastUpdate(n.id);if(!e)return"-";let s=Date.now()-e.getTime(),a=Math.floor(s/6e4);if(a<1)return"Just now";if(a<60)return`${a}m ago`;let d=Math.floor(a/60);return d<24?`${d}h ago`:`${Math.floor(d/24)}d ago`}canCancel(n){return!["Completed","Cancelled"].includes(n.status)}openDrawer(n){this.selectedOrder=n,this.drawerVisible=!0,n.result?this.resultForm.patchValue({resolutionCode:n.result.resolutionCode,summary:n.result.summary,durationMin:n.result.durationMin,technicianNote:n.result.technicianNote,warrantyCovered:n.result.charges?.warrantyCovered,customerCharge:n.result.charges?.customerCharge}):this.resultForm.reset({resolutionCode:"Fixed"})}closeDrawer(){this.drawerVisible=!1,this.selectedOrder=null}setReady(n){this.stateService.updateWorkOrderTracked(n.id,{status:"Ready"}),this.message.success(`Order ${n.number} marked as Ready`)}autoAssign(n){let e=this.autoAssignService.tryAssign(n);e.success?(this.stateService.updateWorkOrderTracked(n.id,{status:"Assigned",assignedTechnicianId:e.technicianId,etaMin:e.etaMin,distanceKm:e.distanceKm}),this.message.success(`Assigned to ${this.getTechName(e.technicianId)}`)):this.message.error(`Auto-assign failed: ${e.reason}`)}cancelOrder(n){this.modal.confirm({nzTitle:"Cancel Order?",nzContent:"This action cannot be undone. Are you sure?",nzOkText:"Yes, Cancel",nzOkDanger:!0,nzOnOk:()=>{this.stateService.updateWorkOrderTracked(n.id,{status:"Cancelled"},"Other","Cancelled by dispatcher"),this.message.info(`Order ${n.number} cancelled`),this.closeDrawer()}})}completeOrder(){if(!this.selectedOrder)return;!!this.selectedOrder.result?this.doComplete():this.modal.confirm({nzTitle:"No Result Recorded",nzContent:"This order has no result recorded. Complete anyway?",nzOkText:"Complete",nzOnOk:()=>this.doComplete()})}doComplete(){this.selectedOrder&&(this.stateService.updateWorkOrderTracked(this.selectedOrder.id,{status:"Completed"}),this.message.success("Order completed"),this.closeDrawer())}showReassignModal(){this.reassignTechId=null,this.reassignReason="Reassign-Capacity",this.reassignNote="",this.reassignModalVisible=!0}confirmReassign(){if(!this.selectedOrder||!this.reassignTechId){this.message.warning("Please select a technician");return}this.stateService.updateWorkOrderTracked(this.selectedOrder.id,{assignedTechnicianId:this.reassignTechId},this.reassignReason,this.reassignNote),this.message.success(`Reassigned to ${this.getTechName(this.reassignTechId)}`),this.reassignModalVisible=!1,this.selectedOrder=this.stateService.getWorkOrder(this.selectedOrder.id)||null}saveResult(){if(!this.selectedOrder)return;if(this.resultForm.invalid){Object.values(this.resultForm.controls).forEach(s=>s.markAsDirty()),this.message.warning("Please fill required fields");return}let n=this.resultForm.value,e={resolutionCode:n.resolutionCode,summary:n.summary,durationMin:n.durationMin,technicianNote:n.technicianNote,charges:{warrantyCovered:n.warrantyCovered,customerCharge:n.customerCharge,total:(n.warrantyCovered||0)+(n.customerCharge||0),currency:"USD"}};this.stateService.updateResult(this.selectedOrder.id,e),this.message.success("Result saved"),["Fixed","InspectionOnly"].includes(n.resolutionCode)&&this.selectedOrder.status!=="Completed"&&this.modal.confirm({nzTitle:"Mark as Completed?",nzContent:"The result has been saved. Would you like to mark this order as Completed?",nzOkText:"Complete",nzOnOk:()=>{this.stateService.updateWorkOrderTracked(this.selectedOrder.id,{status:"Completed"}),this.message.success("Order completed"),this.closeDrawer()}}),this.selectedOrder=this.stateService.getWorkOrder(this.selectedOrder.id)||null}getTimelineColor(n){return{New:"gray",Ready:"gold",Assigned:"blue",EnRoute:"cyan",OnSite:"orange",Completed:"green",OnHold:"red",Cancelled:"red"}[n]||"gray"}getReasonLabel(n){return K[n]||n}formatDateTime(n){return n?new Date(n).toLocaleString():"-"}formatFieldName(n){return n.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}static \u0275fac=function(e){return new(e||t)(S(Ke),S(vt),S(Ot),S(gt),S(Ee))};static \u0275cmp=E({type:t,selectors:[["app-orders"]],decls:37,vars:11,consts:[["basicTable",""],["drawerTitle",""],["noTimeline",""],["noAudit",""],["auditTable",""],[1,"orders-container"],[1,"page-header"],["nz-button","","nzType","primary","routerLink","/create"],[3,"nzData","nzPageSize"],[4,"ngFor","ngForOf"],["nzPlacement","right",3,"nzOnClose","nzClosable","nzVisible","nzTitle","nzWidth"],[4,"nzDrawerContent"],["nzTitle","Reassign Technician",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible"],[4,"nzModalContent"],[3,"click"],[3,"nzColor"],["nzStatus","success","nzText","Yes",4,"ngIf"],["style","color:#999",4,"ngIf"],["nz-button","","nzType","link",3,"click"],["nz-button","","nzType","link",3,"click",4,"ngIf"],["nz-button","","nzType","text","nzDanger","",3,"click",4,"ngIf"],["nzStatus","success","nzText","Yes"],[2,"color","#999"],["nz-button","","nzType","text","nzDanger","",3,"click"],["class","drawer-header",4,"ngIf"],[1,"drawer-header"],[1,"wo-number"],["nzColor","blue",4,"ngIf"],["nzColor","blue"],[4,"ngIf"],["nzTitle","Details"],[1,"tab-content"],["class","action-buttons",4,"ngIf"],["nzTitle","Timeline"],[4,"ngIf","ngIfElse"],["nzTitle","Audit"],["nzSize","small",3,"nzData","nzPageSize",4,"ngIf","ngIfElse"],["nzTitle","Result"],["nz-form","","nzLayout","vertical",3,"formGroup"],["nzRequired",""],["formControlName","resolutionCode",2,"width","100%"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nzErrorTip","Summary is required"],["nz-input","","formControlName","summary","rows","3","placeholder","Describe work performed..."],["formControlName","durationMin",2,"width","100%",3,"nzMin","nzMax"],["nz-input","","formControlName","technicianNote","rows","2","placeholder","Additional notes..."],["nzText","Charges (Optional)"],["nz-row","",3,"nzGutter"],["nz-col","",3,"nzSpan"],["formControlName","warrantyCovered",2,"width","100%",3,"nzMin"],["formControlName","customerCharge",2,"width","100%",3,"nzMin"],[1,"result-actions"],["nz-button","","nzType","primary",3,"click"],[1,"action-buttons"],["nz-button","",3,"click",4,"ngIf"],["nz-button","","nzType","primary",3,"click",4,"ngIf"],["nz-button","",3,"click"],[3,"nzColor",4,"ngFor","ngForOf"],[1,"timeline-item"],[1,"timeline-by"],[1,"timeline-time"],["class","timeline-reason",4,"ngIf"],["class","timeline-note",4,"ngIf"],[1,"timeline-reason"],[1,"timeline-note"],["nzNotFoundContent","No status history yet"],["nzSize","small",3,"nzData","nzPageSize"],["nzNotFoundContent","No changes recorded"],[3,"nzValue","nzLabel"],[2,"width","100%",3,"ngModelChange","ngModel"],["nz-input","","rows","2",3,"ngModelChange","ngModel"]],template:function(e,s){if(e&1){let a=h();r(0,"div",5)(1,"div",6)(2,"h2"),l(3,"Orders"),i(),r(4,"button",7),l(5,"Create Order"),i()(),r(6,"nz-table",8,0),me(8,"async"),r(9,"thead")(10,"tr")(11,"th"),l(12,"Number"),i(),r(13,"th"),l(14,"Customer"),i(),r(15,"th"),l(16,"Category"),i(),r(17,"th"),l(18,"Status"),i(),r(19,"th"),l(20,"Priority"),i(),r(21,"th"),l(22,"Assigned Tech"),i(),r(23,"th"),l(24,"Result"),i(),r(25,"th"),l(26,"Last Update"),i(),r(27,"th"),l(28,"Actions"),i()()(),r(29,"tbody"),p(30,Xt,27,14,"tr",9),i()(),r(31,"nz-drawer",10),C("nzOnClose",function(){return g(a),f(s.closeDrawer())}),p(32,nn,1,1,"ng-template",null,1,b)(34,vn,2,1,"ng-container",11),i(),r(35,"nz-modal",12),R("nzVisibleChange",function(T){return g(a),M(s.reassignModalVisible,T)||(s.reassignModalVisible=T),f(T)}),C("nzOnCancel",function(){return g(a),f(s.reassignModalVisible=!1)})("nzOnOk",function(){return g(a),f(s.confirmReassign())}),p(36,bn,18,5,"ng-container",13),i()()}if(e&2){let a=x(7),d=x(33);o(6),m("nzData",ce(8,8,s.workOrders$)||j(10,It))("nzPageSize",10),o(24),m("ngForOf",a.data),o(),m("nzClosable",!0)("nzVisible",s.drawerVisible)("nzTitle",d)("nzWidth",560),o(4),w("nzVisible",s.reassignModalVisible)}},dependencies:[fe,pe,ue,we,Se,Oe,ye,be,Te,Me,Ie,Ne,ze,Qe,Ue,$e,Be,Ge,je,qe,Ye,He,Ve,De,Re,ke,V,Xe,Ze,Je,et,nt,tt,ot,rt,it,Tt,F,Y,ct,ve,xe,lt,at,mt,st,pt,dt,We,Ae,Le,_t,ut,Ct,zt,ft,Pe,Fe,xt,ht,ge],styles:[".orders-container[_ngcontent-%COMP%]{padding:0}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.drawer-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.wo-number[_ngcontent-%COMP%]{font-weight:600;font-size:16px}.tab-content[_ngcontent-%COMP%]{padding:16px 0}.action-buttons[_ngcontent-%COMP%]{margin-top:16px;display:flex;gap:8px}.timeline-item[_ngcontent-%COMP%]{line-height:1.6}.timeline-by[_ngcontent-%COMP%]{color:#666}.timeline-time[_ngcontent-%COMP%]{font-size:12px;color:#999}.timeline-reason[_ngcontent-%COMP%]{margin-top:4px}.timeline-note[_ngcontent-%COMP%]{font-style:italic;color:#666;margin-top:4px}.result-actions[_ngcontent-%COMP%]{margin-top:16px;display:flex;justify-content:flex-end}"]})};export{Nt as OrdersComponent};
